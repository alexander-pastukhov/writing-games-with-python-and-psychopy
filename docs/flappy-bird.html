<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Flappy Bird | Writing games with Python and PsychoPy</title>
<meta name="author" content="Alexander (Sasha) Pastukhov">
<meta name="description" content="Today we will stat developing a Flappy Bird game. You control a bird that must fly through the openings in the obstacles but your only action is to “flap the wings” in order to counteract the...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 12 Flappy Bird | Writing games with Python and PsychoPy">
<meta property="og:type" content="book">
<meta property="og:url" content="https://alexander-pastukhov.github.io/writing-games-with-python-and-psychopy/flappy-bird.html">
<meta property="og:description" content="Today we will stat developing a Flappy Bird game. You control a bird that must fly through the openings in the obstacles but your only action is to “flap the wings” in order to counteract the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Flappy Bird | Writing games with Python and PsychoPy">
<meta name="twitter:description" content="Today we will stat developing a Flappy Bird game. You control a bird that must fly through the openings in the obstacles but your only action is to “flap the wings” in order to counteract the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Writing games with Python and PsychoPy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="software.html"><span class="header-section-number">2</span> Software</a></li>
<li><a class="" href="programming-tips.html"><span class="header-section-number">3</span> Programming tips and tricks</a></li>
<li><a class="" href="python-basics.html"><span class="header-section-number">4</span> Python basics</a></li>
<li><a class="" href="guess-the-number-single-round.html"><span class="header-section-number">5</span> Guess the Number: a single round edition</a></li>
<li><a class="" href="guess-the-number-multi-round.html"><span class="header-section-number">6</span> Guess the Number: a multi round edition</a></li>
<li><a class="" href="guess-the-number-ai.html"><span class="header-section-number">7</span> Guess the Number: AI takes a turn</a></li>
<li><a class="" href="psychopy-basics.html"><span class="header-section-number">8</span> Gettings started with PsychoPy</a></li>
<li><a class="" href="whack-a-mole.html"><span class="header-section-number">9</span> Whack-a-Mole</a></li>
<li><a class="" href="memory-game.html"><span class="header-section-number">10</span> Memory game</a></li>
<li><a class="" href="christmas-special.html"><span class="header-section-number">11</span> Christmas special</a></li>
<li><a class="active" href="flappy-bird.html"><span class="header-section-number">12</span> Flappy Bird</a></li>
<li><a class="" href="seminar-02-06.html"><span class="header-section-number">13</span> Guitar Hero: staircase and iterator functions</a></li>
<li><a class="" href="the-snake.html"><span class="header-section-number">14</span> The Snake</a></li>
<li><a class="" href="moon-lander.html"><span class="header-section-number">15</span> Moon lander</a></li>
<li><a class="" href="space-invaders.html"><span class="header-section-number">16</span> Space invaders: mixins and duck typing</a></li>
<li><a class="" href="game-of-life-numpy.html"><span class="header-section-number">17</span> Game of life (NumPy)</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="flappy-bird" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Flappy Bird<a class="anchor" aria-label="anchor" href="#flappy-bird"><i class="fas fa-link"></i></a>
</h1>
<p>Today we will stat developing a <em>Flappy Bird</em> game. You control a bird that must fly through the openings in the obstacles but your only action is to “flap the wings” in order to counteract the effect of gravity. This is how the game will look like at the end.</p>
<div style="text-align:center;">
<video controls><source src="videos/flappy-bird.m4v" type="video/mp4"></source></video>
</div>
<div id="chapter-concepts-7" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Chapter concepts<a class="anchor" aria-label="anchor" href="#chapter-concepts-7"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Object-oriented programming</li>
<li><code>@property</code></li>
</ul>
<p>We will use this game as an opportunity to learn more about object-oriented programming. You already know how to use classes, now you get to create them and see how it makes your life easier.</p>
</div>
<div id="object-oriented-programming" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Object-oriented programming<a class="anchor" aria-label="anchor" href="#object-oriented-programming"><i class="fas fa-link"></i></a>
</h2>
<p>The core idea is in the name: Instead of having variables/data and functions separately, you combine them in an object that has attrbutes/properties (its own variables) and methods (functions). This approach uses our natural tendency to perceive the world as a collection of interacting objects and has several advantages that I will discuss below.</p>
<div id="classes-and-objects-instances-of-classes" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> Classes and objects (instances of classes)<a class="anchor" aria-label="anchor" href="#classes-and-objects-instances-of-classes"><i class="fas fa-link"></i></a>
</h3>
<p>Before we continue, I need to make an important distinction between <em>classes</em> and <em>objects</em>. A <em>class</em> is a “blue print” that describes properties and behavior (methods) of objects of that class. This “blue print” is used to create an <em>instance</em> of that class, which is called an <em>object</em>. For example, Homo sapiens is a <em>class</em> that describes species that have certain properties, such as height, and can do certain things, such as running. However, Homo sapiens as a class only has a concept of height but no specific height itself. E.g., you cannot ask “What is height of Homo sapiens?” only what is an average (mean, median, etc.) height of individuals of that class. Similarly, you cannot say “Run, Homo sapiens! Run!” as abstract concepts have trouble with real actions like that. Instead, it is Alexander Pastukhov who is an <em>instance</em> of Homo sapiens class with a specific height and a specific (not particularly good) ability to run. Other instances of Homo sapiens (other people) will have different height and a different (typically better) ability to run. Thus, class describes what kind of properties and methods objects have. This means that whenever you meet a Homo sapien, you could be sure that they have height. However, individual objects have different values for various properties and so calling their methods (asking them to perform certain actions) may result in different outcomes.</p>
<p>Another, a more applied, example would be your use of <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> <em>class</em> to create multiple <em>instances</em> of front side of a card in <a href="memory-game">Memory</a> game. Again, the <em>class</em> defines properties (<code>image</code>, <code>pos</code>, <code>size</code>, etc.) and methods (e.g., method <code>draw()</code>) that individual <em>objects</em> will have. You created these objects to serve as front side of cards. You set <em>different</em> values for same properties (<code>image</code>, <code>pos</code>) and that ensured that when you call their method <code>draw()</code>, each card was drawn at its own location and with it own image.</p>
</div>
<div id="encapsulation" class="section level3" number="12.2.2">
<h3>
<span class="header-section-number">12.2.2</span> Encapsulation<a class="anchor" aria-label="anchor" href="#encapsulation"><i class="fas fa-link"></i></a>
</h3>
<p>Putting all the data (properties) and behavior (methods) inside the class simplifies programming by ensuring that all relevant information can be found in its definition. Thus, you have a single place that should hold <em>everything</em> that defines object’s behavior. Contrast this with our approach in previous seminars where cards as dictionaries were separate from functions that created them. Today, you will see how encapsulating everything into classes turns this mess into a simpler and easier-to-understand code.</p>
</div>
<div id="inheritance-generalization" class="section level3" number="12.2.3">
<h3>
<span class="header-section-number">12.2.3</span> Inheritance / Generalization<a class="anchor" aria-label="anchor" href="#inheritance-generalization"><i class="fas fa-link"></i></a>
</h3>
<p>In object-oriented programming, a class can be derived from some other <em>ancestor</em> class and thus <em>inherit</em> its properties and methods. Moreover, several classes can be derived from a single ancestor producing a mix of unique and shared functionality. This means that instead of rewriting the same code for each class, you can define a common code in an ancestor class and focus on differences or additional methods and properties in descendants.</p>
<p>Using the Homo sapiens example from above. Humans, chimpanzees and gorillas are all different species but we share a common ancestor. Hence, we are different in many respect, yet, you could think about all of us as “apes” that have common properties such as binocular trichromatic vision. In other words, if you are interested in color vision, you do not care what specific species you are looking it, as all apes are (roughly) the same in that respect. Or, you can move further down the evolution tree and think about us as “mammals” that, again, have common properties and behavior, such as thermoregulation and lactation. Again, if you are interested <em>only</em> in whether an animal has thermoregulation, knowing that it is a mammal is enough.</p>
<p>Similarly, in PsychoPy various visual stimuli that we used (<a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>, <a href="https://psychopy.org/api/visual/textstim.html#psychopy.visual.TextStim">TextStim</a>, <a href="https://psychopy.org/api/visual/rect.html#psychopy.visual.rect.Rect">Rect</a>) have same properties (e.g., <code>pos</code>, <code>size</code>, etc.) and methods (most notably, <code>draw()</code>). This is because they are all descendants from a common ancestor <code>BaseVisualStim</code> that defines their common properties and methods<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;BaseVisualStim&lt;/code&gt; does not actually define &lt;code&gt;draw()&lt;/code&gt; method, only that it must be present.&lt;/p&gt;"><sup>62</sup></a>. This means that you can assume that <em>any</em> visual stimulus (as long as it descends from <code>BaseVisualStim</code>) will have <code>size</code>, <code>pos</code>, <code>ori</code> and can be drawn. This, in turn, means that you can have a list of various PsychoPy visual stimuli and move or draw all of them in a single loop without thinking which <em>specific</em> visual stimulus you are moving or drawing. Also note that you cannot assume these same properties for <em>sound</em> stimuli because they are <em>not</em> descendants of <code>BaseVisualStim</code> but of <code>_SoundBase</code> class.</p>
<p>Where is other way of achieving common behavior (generalization) in Python without orderly inheritance, such as “duck typing”<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Yes, it is really called “duck typing”.&lt;/p&gt;"><sup>63</sup></a> but it will be a topic of another seminar.</p>
</div>
<div id="polymorphism" class="section level3" number="12.2.4">
<h3>
<span class="header-section-number">12.2.4</span> Polymorphism<a class="anchor" aria-label="anchor" href="#polymorphism"><i class="fas fa-link"></i></a>
</h3>
<p>As you’ve learned in the previous section, inheritance allows different descendants to share common properties and behavior, so that in certain cases you can view them as being equivalent to an ancestor. E.g., any visual stimulus (a descendant of <code>BaseVisualStim</code> class) can be drawn, so you just call its <code>draw()</code> method. However, it is clear that these different stimuli implement drawing <em>differently</em>, as the <a href="https://psychopy.org/api/visual/rect.html#psychopy.visual.rect.Rect">Rect</a> stimulus looks different from the <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> or <a href="https://psychopy.org/api/visual/textstim.html#psychopy.visual.TextStim">TextStim</a>. This is called “polymorphism” and the idea is to keep the common interface (same <code>draw()</code> call) while abstracting away the actual implementation. This allows you to think about what you want an object to do (or what to do with an object), instead of thinking how exactly it is implemented.</p>
</div>
<div id="a-minimal-class-example" class="section level3" number="12.2.5">
<h3>
<span class="header-section-number">12.2.5</span> A minimal class example<a class="anchor" aria-label="anchor" href="#a-minimal-class-example"><i class="fas fa-link"></i></a>
</h3>
<p>Enough of the theory, let us see how classes are implemented in Python. Here is a very simple class that has nothing but the <em>constructor</em> <code>__init__()</code> method, which is called whenever a new object (class instance) is created, and a single attribute / property <code>total</code>.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="flappy-bird.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Accumulator:</span>
<span id="cb107-2"><a href="flappy-bird.html#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb107-3"><a href="flappy-bird.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Simple class that accumulates (sums up) values.</span></span>
<span id="cb107-4"><a href="flappy-bird.html#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="flappy-bird.html#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Properties</span></span>
<span id="cb107-6"><a href="flappy-bird.html#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb107-7"><a href="flappy-bird.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co">    total : float</span></span>
<span id="cb107-8"><a href="flappy-bird.html#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Total accumulated value</span></span>
<span id="cb107-9"><a href="flappy-bird.html#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb107-10"><a href="flappy-bird.html#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="flappy-bird.html#cb107-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb107-12"><a href="flappy-bird.html#cb107-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb107-13"><a href="flappy-bird.html#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Constructor, initializes the total value to zero.</span></span>
<span id="cb107-14"><a href="flappy-bird.html#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb107-15"><a href="flappy-bird.html#cb107-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb107-16"><a href="flappy-bird.html#cb107-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb107-17"><a href="flappy-bird.html#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="co"># here we create an object number_sum, which is an instance of class Accumulator.</span></span>
<span id="cb107-18"><a href="flappy-bird.html#cb107-18" aria-hidden="true" tabindex="-1"></a>number_sum <span class="op">=</span> Accumulator()</span>
<span id="cb107-19"><a href="flappy-bird.html#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(number_sum.total)</span></code></pre></div>
<p>Let’s go through it line by line. First line <code>class Accumulator:</code> shows that this is a declaration of a <code>class</code> whose name is <code>Accumulator</code>. Note that the first letter is capitalized. This is not required per se, so Python police won’t be knocking on your door if you write it all in lower or upper case. However, the general recommendation is that <strong>class</strong> names are written using <code>UpperCaseCamelCase</code> whereas <strong>object</strong> (instances of the class) names are written using <code>lower_case_snake_case</code>. This makes distinguishing between classes and objects (instances of classes) easier, so you should follow this convention.</p>
<p>The definition of the class are the remaining <em>indented</em> lines. As with functions or loops, it is the indentation that defines what is inside and what is outside of the class. The only method we defined is <code>def __init__(self):</code>. This is a <em>special</em> method<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;There are more special methods that you will learn about later, they all follow &lt;code&gt;__methodname__()&lt;/code&gt; convention.&lt;/p&gt;"><sup>64</sup></a> that is called when an object (instance of the class) is created. This allows you to initialize the object based on parameters that were passed to this function (if any). You do not call this function directly, rather it is called whenever an object is created, e.g., <code>number_sum = Accumulator()</code> (last line). Also, it does not return any value explicitly via <code>return</code>. Instead, <code>self</code> (the very first parameter, more on it below) is returned automatically.</p>
<p>All class methods (apart from special cases we currently do not concern ourselves with) must have one special first parameter that is <em>the object</em> itself. By convention it is called <code>self</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Again, you can use any name for that parameter but that will surely confuse everyone.&lt;/p&gt;"><sup>65</sup></a>. It is passed to the method automatically, so whenever you write <code>square.draw()</code> (no explicit parameters written in the function call), the actual method still receives one parameter that is the <em>reference</em> to the <code>square</code> variable whose method you called. Inside a method, you use this variable to refer to the object itself.
Let us go back to the constructor <code>__init()__</code> to see how you can use <code>self</code>. Here, we add a new <em>persistent</em> attribute/property to the object and assign a value to it: <code>self.total = 0</code>. It is <em>persistent</em>, because even though we created it inside the method, the mutable object is passed by reference and, therefore, we assigned it to the object itself. Now you can use this property either from inside <code>self.total</code> or from outside <code>number_sum.total</code>. You can think of properties as being similar to field/value pairs in the dictionary we used in Memory game but for syntax: <code>object.property</code> versus <code>dictonary["field"]</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;This is actually how all properties and methods are stored, in a &lt;code&gt;__dict__&lt;/code&gt; attribute, so you can write &lt;code&gt;number_sum.__dict__["total"]&lt;/code&gt; to get it.&lt;/p&gt;'><sup>66</sup></a>. Technically, you can create new properties in any method or even from outside (e.g., nothing prevents you from writing <code>number_sum.color = "red"</code>). However, this makes understanding the code much harder, so the general recommendation is to create <em>all</em> properties inside the constructor <code>__init__()</code> method, even if this means assigning <code>None</code> to them<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;If you use a linter, it will complain whenever it sees a property not defined in the constructor&lt;/p&gt;"><sup>67</sup></a>.</p>
</div>
<div id="add-method" class="section level3" number="12.2.6">
<h3>
<span class="header-section-number">12.2.6</span> <code>add</code> method<a class="anchor" aria-label="anchor" href="#add-method"><i class="fas fa-link"></i></a>
</h3>
<p>Let us add a method that adds 1 to the <code>total</code> property.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="flappy-bird.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Accumulator:</span>
<span id="cb108-2"><a href="flappy-bird.html#cb108-2" aria-hidden="true" tabindex="-1"></a>    ... <span class="co"># I am skipping all previous code here</span></span>
<span id="cb108-3"><a href="flappy-bird.html#cb108-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-4"><a href="flappy-bird.html#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>):</span>
<span id="cb108-5"><a href="flappy-bird.html#cb108-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb108-6"><a href="flappy-bird.html#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co">        Add 1 to total</span></span>
<span id="cb108-7"><a href="flappy-bird.html#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb108-8"><a href="flappy-bird.html#cb108-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total <span class="op">+=</span> <span class="dv">1</span></span></code></pre></div>
<p>It has first special argument <code>self</code> that is the object itself and we simply add 1 to its <code>total</code> property. Again, remember that <code>self</code> is passed automatically whenever you call the method, meaning that an actual call looks like <code>number_sum.add()</code>.</p>
<p>Create a Jupyter notebook (you will need to submit it as part of the assignment) and copy-paste the code for <code>Accumulator</code> class, including the <code>.add()</code> method. Create <strong>two</strong> objects, call them <code>counter1</code> and <code>counter2</code>. Call <code>.add()</code> method twice for <code>counter2</code> and thrice for <code>counter1</code> (bonus: do it using <code>for</code> loop). What is the value of the <code>.total</code> property of each object? Check it by printing it out.</p>
<div class="rmdnote practice">
<p>Copy-paste and test <code>Accumulator</code> class code in a Jupiter notebook.</p>
</div>
</div>
<div id="flexible-accumulator-with-a-subtract-method" class="section level3" number="12.2.7">
<h3>
<span class="header-section-number">12.2.7</span> Flexible accumulator with a <code>subtract</code> method<a class="anchor" aria-label="anchor" href="#flexible-accumulator-with-a-subtract-method"><i class="fas fa-link"></i></a>
</h3>
<p>Now lets us create a new class that is a <em>descendant</em> of the <code>Accumulator</code>. We will call it <code>FlexibleAccumulator</code> as it will allow you to also <em>subtract</em> from the total count. You specify ancestors (could be more than one!) in round brackets after the class name</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="flappy-bird.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FlexibleAccumulator(Accumulator):</span>
<span id="cb109-2"><a href="flappy-bird.html#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span> <span class="co"># You must have at least one non-empty line, and pass means "do nothing"</span></span></code></pre></div>
<p>Now you have a new class that is a descendant of <code>Accumulator</code> but, so far, is a perfect copy of it. Add <code>subtract</code> method to the class. It should subtract <code>1</code> from the <code>.total</code> property (don’t forget to <em>document</em> it!). Check that it works. Create one instance of <code>Accumulator</code> and another one of <code>FlexibleAccumulator</code> class and check that you can call <code>add()</code> on both of them but <code>subtract()</code> only for the latter.</p>
<div class="rmdnote practice">
<p>Add <code>subtract</code> method to the <code>FlexibleAccumulator</code><br>
class in a Jupiter notebook. Add testing.</p>
</div>
</div>
</div>
<div id="method-arguments" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Method arguments<a class="anchor" aria-label="anchor" href="#method-arguments"><i class="fas fa-link"></i></a>
</h2>
<p>Now, create a new class <code>SuperFlexibleAccumulator</code> that will be able to both <code>add()</code> and <code>subtract()</code> an <em>arbitrary</em> value. Think about which class it should inherit from. Redefine both <code>.add()</code> and <code>.subtract()</code> method in that new class by adding <code>value</code> argument to both method and add/subtract this value rather than <code>1</code>. Note that now you have <em>two</em> arguments in each method <code>(self, value)</code> but when you call you only need to pass the latter (again, <code>self</code> is passed automatically). Don’t forget to document <code>value</code> argument (but you do not need to document <code>self</code> as its meaning is fixed).</p>
<div class="rmdnote practice">
<p>Create <code>SuperFlexibleAccumulator</code> class and define<br>super flexible <code>add</code> and <code>subtract</code> methods<br>that have <code>value</code> parameter ( in a Jupiter notebook).<br>Test them!</p>
</div>
<div id="constructor-arguments" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> Constructor arguments<a class="anchor" aria-label="anchor" href="#constructor-arguments"><i class="fas fa-link"></i></a>
</h3>
<p>Although constructor <code>__init(...)__</code> is special, it is still a method. Thus, you can pass arguments to it just like you did it for other methods. You pass these arguments when you create an object, so in our case, you put it inside the bracket for <code>counter = SuperFlexibleAccumulator(...)</code>.</p>
<p>Modify the code so that you pass the initial value that total is set to, instead of zero.</p>
<div class="rmdnote practice">
<p>Add <code>initial_value</code> parameter to the constructor of the <code>SuperFlexibleAccumulator</code> class in a Jupiter notebook. Test it!</p>
</div>
</div>
<div id="calling-methods-from-other-methods" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> Calling methods from other methods<a class="anchor" aria-label="anchor" href="#calling-methods-from-other-methods"><i class="fas fa-link"></i></a>
</h3>
<p>You can call a function or object’s method at any point of time, so, logically, you can use methods inside methods. Let’s modify our code, realizing that <em>subtracting</em> a value is like <em>adding a negative</em> value. Modify your code, so that <code>.subtract()</code> only negates the value before passing is to <code>.add()</code> for actual processing. Thus, <code>total</code> is modified <em>only</em> inside the <code>add()</code> method.</p>
<div class="rmdnote practice">
<p>Modify <code>subtract()</code> method of <code>SuperFlexibleAccumulator</code><br>to utilize <code>add()</code> in a Jupiter notebook.<br>Test it!</p>
</div>
</div>
<div id="local-variables" class="section level3" number="12.3.3">
<h3>
<span class="header-section-number">12.3.3</span> Local variables<a class="anchor" aria-label="anchor" href="#local-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Just like normal functions, you methods can have local variables. They are local (visible and accessible only from within the method) and are not persistent (their values do not survive between the calls). Conceptually, you separate variables that need to be persistent (retain their value the whole time object exists) as attributes/properties and temporary variables that are need only for the computation itself as local method variables. What would be value of property <code>.total</code> in this example:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="flappy-bird.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Accumulator:</span>
<span id="cb110-2"><a href="flappy-bird.html#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, initial):</span>
<span id="cb110-3"><a href="flappy-bird.html#cb110-3" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> initial <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb110-4"><a href="flappy-bird.html#cb110-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total <span class="op">=</span> initial</span>
<span id="cb110-5"><a href="flappy-bird.html#cb110-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-6"><a href="flappy-bird.html#cb110-6" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> Accumulator(<span class="dv">1</span>)</span></code></pre></div>
<p>What about in this case?</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="flappy-bird.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Accumulator:</span>
<span id="cb111-2"><a href="flappy-bird.html#cb111-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, initial):</span>
<span id="cb111-3"><a href="flappy-bird.html#cb111-3" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> initial <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb111-4"><a href="flappy-bird.html#cb111-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total <span class="op">=</span> temp</span>
<span id="cb111-5"><a href="flappy-bird.html#cb111-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb111-6"><a href="flappy-bird.html#cb111-6" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> Accumulator(<span class="dv">1</span>)</span></code></pre></div>
</div>
</div>
<div id="flappy-bird-the-humble-beginnings" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Flappy Bird: the humble beginnings<a class="anchor" aria-label="anchor" href="#flappy-bird-the-humble-beginnings"><i class="fas fa-link"></i></a>
</h2>
<p>We will start with a basic scaffolding for our program. Download the <a href="material/Blue-Bird.png">bird image</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Created by &lt;a href="https://openclipart.org/artist/Scout"&gt;Madison Kingsford&lt;/a&gt;.&lt;/p&gt;'><sup>68</sup></a> and put it into a folder where you will store the code. Create a basic code that uses <a href="settings-files">settings file</a> that defines minimal setting for a window (size) and a bird (image file). Organize it hierarchically, as follows, as this will help us keep settings for different classes organized.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb112-1"><a href="flappy-bird.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb112-2"><a href="flappy-bird.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Bird"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-3"><a href="flappy-bird.html#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"Image"</span> <span class="fu">:</span> <span class="st">"Blue-Bird.png"</span></span>
<span id="cb112-4"><a href="flappy-bird.html#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb112-5"><a href="flappy-bird.html#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Window"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-6"><a href="flappy-bird.html#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"Size"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">800</span><span class="ot">,</span> <span class="dv">600</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb112-7"><a href="flappy-bird.html#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb112-8"><a href="flappy-bird.html#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Create a <a href="https://psychopy.org/api/visual/window.html#psychopy.visual.Window">window</a> using this specified size and an <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> using the filename from the settings file. Add a basic game loop in which you repeatedly draw the bird (should appear right at the center of the screen) and check for a key press (<em>escape</em> should exit the game).</p>
<div class="rmdnote program">
<p>Put your code into <code>code01.py</code>.</p>
</div>
</div>
<div id="flappy-bird-class" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Flappy Bird class<a class="anchor" aria-label="anchor" href="#flappy-bird-class"><i class="fas fa-link"></i></a>
</h2>
<p>Our flappy bird is, effectively, an image but we would like it to have additional behaviors, like, automatically falling down due to gravity, flying up due to flapping its wings, etc. There are several way we can do this. We can keep the image in <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> and write additional functions to handle it (the way we did previously). We could create an new class <code>FlappyBird</code> that will have the <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> as its attribute. Or, we could utilize the power of inheritance and build <code>FlappyBird</code> class on top of the <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>. This means less work for us, so that is the path we will follow.</p>
<p>Create a new file that will contain your <code>FlappyBird</code> class. Here is how it should look like:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="flappy-bird.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Your comment on what this file contains.</span></span>
<span id="cb113-2"><a href="flappy-bird.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb113-3"><a href="flappy-bird.html#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import libraries, which ones do you need?</span></span>
<span id="cb113-4"><a href="flappy-bird.html#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="flappy-bird.html#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FlappyBird(visual.ImageStim):</span>
<span id="cb113-6"><a href="flappy-bird.html#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb113-7"><a href="flappy-bird.html#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co">  FlappyBird class based on ImageStim</span></span>
<span id="cb113-8"><a href="flappy-bird.html#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb113-9"><a href="flappy-bird.html#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, win, settings):</span>
<span id="cb113-10"><a href="flappy-bird.html#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb113-11"><a href="flappy-bird.html#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Constructor.</span></span>
<span id="cb113-12"><a href="flappy-bird.html#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb113-13"><a href="flappy-bird.html#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">super</span>().<span class="fu">__init__</span>(win, image<span class="op">=</span>settings[<span class="st">"Image"</span>])</span></code></pre></div>
<p>In the code above, I defined <code>FlappyBird</code> as a descendant of the <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>. To make the latter work, we need to initialize it properly by calling it constructor. This is what <code>super().__init__(...)</code> call does: Calls constructor of the ancestor class to enable all the magic that we want to reuse. Recall that <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> needs at least two parameters: a PsychoPy <a href="(https://psychopy.org/api/visual/window.html#psychopy.visual.Window)">window</a> that the stimulus will belong to and an image (a filename in this case). Here, I assume that when I create a bird object (call the constructor), I pass <em>two</em> parameters (again, <code>self</code> comes “for free”, so you do not pass it explicitly but assume that it is the <em>first</em> argument that you get): the [window]((<a href="https://psychopy.org/api/visual/window.html#psychopy.visual.Window" class="uri">https://psychopy.org/api/visual/window.html#psychopy.visual.Window</a>) that we created plus a dictionary with settings for the bird (there will be more settings, so it would be practical to pass the whole dictionary instead of passing one parameter at a time).</p>
<p>Copy paste that code (plus add appropriate imports and comments) and use <code>FlappyBird</code> class instead of <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>. Note that <code>FlappyBird</code> inherits <em>all</em> its functionality from <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>, so, apart from how you create it, you can use it in exactly the same way. Meaning, you do not need to modify anything else in your code (told you, it would save us time and effort!).</p>
<div class="rmdnote program">
<p>Put <code>FlappyBird</code> class code into a separate file.<br>
Use it instead of <code>ImageStim</code> in <code>code02.py</code>.</p>
</div>
</div>
<div id="a-properly-sized-bird" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> A properly-sized bird<a class="anchor" aria-label="anchor" href="#a-properly-sized-bird"><i class="fas fa-link"></i></a>
</h2>
<p>Our bird is very cute but is way too large. Add a new setting for it (I suggest calling is <code>Size</code> and setting it to 0.1) and then use it inside the constructor adding <code>size=...</code> to <code>super().__init__</code> call. Do you need to change anything in the main code?</p>
<div class="rmdnote program">
<p>Add bird size setting.<br>
Use it in <code>FlappyBird</code> class constructor.</p>
</div>
</div>
<div id="flappy-bird-is-falling-down-my-dear-lady" class="section level2" number="12.7">
<h2>
<span class="header-section-number">12.7</span> Flappy Bird is falling down (my dear lady)<a class="anchor" aria-label="anchor" href="#flappy-bird-is-falling-down-my-dear-lady"><i class="fas fa-link"></i></a>
</h2>
<p>Before our bird flies, it needs to learn how to fall down. Falling down is just a change of bird’s vertical position based on bird’s vertical speed. We already have a property for the (horizontal and) vertical position: <code>self.pos</code>, a tuple with <code>(x, y)</code> position of the center of the image. But we do need an additional new attribute that would encode bird’s vertical speed. Create it in the constructor (if you forgot how to do it, take a look above on how we create the <code>total</code> attribute for <code>Accumulator</code> class) and call it <code>vspeed</code>. Also, create a new setting (I would call it <code>"Initial vertical speed"</code>) and set it to <code>-0.01</code>, use this setting in the constructor to initialize <code>vspeed</code>.</p>
<p>Now we also need a method that would update bird’s position based on its (current) speed. Create this method below the constructor (does it need any parameters beyond compulsory <code>self</code>?). It should simply compute <span class="math inline">\(y_{new} = y + vspeed\)</span> and assign <span class="math inline">\(y_{new}\)</span> back to <code>pos</code> attribute (note that you cannot assign only y coordinate, you have to pass the tuple <code>(x, y)</code> reusing original <code>x</code> value from <code>pos</code>). Do not forget to document the new method!</p>
<p>Now you need to call the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> on each frame before drawing the bird. This should make your bird fall of the screen! (Experiment with <code>"Initial vertical speed"</code> setting to make it fall faster or slower or even upwards!)</p>
<div class="rmdnote program">
<p>Update <code>FlappyBird</code> class.<br>
Use <code>update</code> method in <code>code03.py</code>.</p>
</div>
</div>
<div id="timing-the-fall" class="section level2" number="12.8">
<h2>
<span class="header-section-number">12.8</span> Timing the fall<a class="anchor" aria-label="anchor" href="#timing-the-fall"><i class="fas fa-link"></i></a>
</h2>
<p>Currently, the speed of our bird’s fall is measured in <code>norm units / frame</code>. This works but these are not the most convenient units to think in. Plus, it relies on PsychoPy (and the rest of our code) to ensure that time between individual frames is exactly the same. This is <em>mostly</em> the case and is an occasionally slow bird is not a big problem for a game. However, that might be a problem for an actual experiment that requires precise timing of movement. Thus, we need to think about vertical speed in units of <code>norm units / second</code> and measure time between calls of <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> method ourselves.</p>
<p>Create a new <a href="https://psychopy.org/api/clock.html#psychopy.clock.Clock">Clock</a> attribute that will count the time elapsed since it last reset (I would call it <code>frame_timer</code>). Modify the <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> method to compute <span class="math inline">\(y_{new} = y + vspeed * T_{elapsed}\)</span>, where <span class="math inline">\(T_{elapsed}\)</span> is the time elapsed between frames. Do not forget to reset the timer! (What will happen if you do forget?)</p>
<p>Now set your <code>"Initial vertical speed"</code> to some reasonable value (e.g., 0.5) and check that the time it takes for the bird to fall of the screen looks reasonable (for 0.5 norm units / second it should be off the screen in two seconds).</p>
<div class="rmdnote program">
<p>Update <code>FlappyBird</code> class with a timer.</p>
</div>
</div>
<div id="it-is-all-newtons-fault" class="section level2" number="12.9">
<h2>
<span class="header-section-number">12.9</span> It is all Newton’s fault<a class="anchor" aria-label="anchor" href="#it-is-all-newtons-fault"><i class="fas fa-link"></i></a>
</h2>
<p>Now let us add gravity, so that the speed of falling would be constantly changing. Create a new setting and call it <code>"Gravity"</code>. Set it to <code>-0.5</code> (units are <code>norm units per second squared</code>) but experiment with different values later on. Acceleration due to gravity changes vertical speed just like speed itself changes the vertical position. Update your <code>update</code> method to change the speed based on acceleration given the elapsed time. What do you need to update first, the speed or the location? Also, think about how you will store the acceleration: It is in settings parameter that exists only in the constructor. You can either store it in a new attribute or store all settings in an attribute for later use.</p>
<div class="rmdnote program">
<p>Update <code>FlappyBird</code> class with acceleration due to gravity.</p>
</div>
</div>
<div id="flap-bird-flap" class="section level2" number="12.10">
<h2>
<span class="header-section-number">12.10</span> Flap bird, flap!<a class="anchor" aria-label="anchor" href="#flap-bird-flap"><i class="fas fa-link"></i></a>
</h2>
<p>Let us add ability of the bird to “flap” in order to stay in the air. First, create a new setting <code>Flap speed</code> and set it to <code>0.4</code> (as usual, feel free to experiment!). Add a new method <code>.flap(self)</code> and inside simply set <code>vspeed</code> to <code>Flap speed</code>. Thus, a single flap sets the bird flying up with <code>Flap speed</code> speed which, however, will be constantly reduced by the accelartion due to <code>Gravity</code> so the bird will eventually start falling down again.</p>
<p>In the main code, check for <code>"escape"</code> and <code>"space"</code> keys. If the latter is pressed, call <code>.flap()</code> method of the bird. Check that you can keep the on the screen by timing the space button presses or can make it fly upwards off the screen.</p>
<div class="rmdnote program">
<p>Add <code>flap</code> method to <code>FlappyBird</code> class.<br>
Use it in <code>code04.py</code> whenever player presses <em>space</em>.</p>
</div>
</div>
<div id="stay-off-the-ground" class="section level2" number="12.11">
<h2>
<span class="header-section-number">12.11</span> Stay off the ground<a class="anchor" aria-label="anchor" href="#stay-off-the-ground"><i class="fas fa-link"></i></a>
</h2>
<p>In our game, the player can lose either if they hit an obstacle (we do not have any yet) or if the bird drops below the ground level, i.e., the bottom edge of the window. Create a new method <code>is_airborne()</code> that will return <code>True</code> if <code>y</code> position of the bird is above <code>-1</code> (note, you do not need an explicit <code>if</code> for this, nor do you need to write <code>True</code> or <code>False</code> anywhere, think how this can be done without these).</p>
<p>In the main loop add the check for <code>bird.is_airborne()</code> condition so that it continues until player presses <code>"escape"</code> or the bird hits the ground.</p>
<div class="rmdnote program">
<p>Add <code>is_airborne</code> method to <code>FlappyBird</code> class.<br>
Use it in <code>code05.py</code> as an additional condition<br>for the game loop.</p>
</div>
</div>
<div id="computed-attribute-property" class="section level2" number="12.12">
<h2>
<span class="header-section-number">12.12</span> Computed attribute <code>@property</code><a class="anchor" aria-label="anchor" href="#computed-attribute-property"><i class="fas fa-link"></i></a>
</h2>
<p>As was explained the in “Object-oriented programming” section above, properties describe state of an object, whereas methods describe what an object can do or what you do to an object. Our <code>is_airborne()</code> method breaks this logic: It describes the <em>state</em> of the bird but we <em>call</em> it (use it) as a method. What we have here is a <em>computed</em> property that is inferred from other properties of an object. In our case, we infer property <code>is_airborne</code> from <code>y</code>. We could, of course, make <code>is_airborne</code> into a real property by defining it in the constructor and then updating it inside <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> method. However, we will instead use a cool feature (called <a href="https://www.python.org/dev/peps/pep-0318/">decorators</a>) to turn a method into a read-only property. The only thing you need to do is to add <code>@property</code> decorator right above the <code>def is_airborne(self):</code> line and drop brackets when using it in the main loop (so just <code>bird.is_airborne</code> instead of <code>bird.is_airborne()</code>).</p>
<p><code>@property</code> tells Python that the method right below <strong>will</strong> (must!) return a value and that outside world should see it not as a method but as a <em>property</em>. You can use it to make properties read-only, so that they could not be (easily) changed from outside or to create properties that are computed on-the-fly as in our example.</p>
<p>Note that difference is not so much of practical implementation (changes we made to the code were minimal) but of a conceptual nature: Object’s states should be properties not methods. In our small example this may look like an overkill but in a moderately complex project even small conceptual blurring of lines could make it harder to understand the code.</p>
<div class="rmdnote program">
<p>Turn <code>is_airborne</code> into a property.<br>
Use it as property in <code>code06.py</code>.</p>
</div>
</div>
<div id="an-opening-in-an-obstacle" class="section level2" number="12.13">
<h2>
<span class="header-section-number">12.13</span> An opening in an obstacle<a class="anchor" aria-label="anchor" href="#an-opening-in-an-obstacle"><i class="fas fa-link"></i></a>
</h2>
<p>We aim of the game is for the bird to fly avoiding obstacles. An obstacle consist of two rectangle, one that protrudes from above and another one from below. The opening between them gives the bird an opportunity to fly through. So let us begin by writing a code (in the Jupyter notebook) that would generate a random opening, characterized by <code>y_bottom</code> and <code>y_top</code> based on four parameters:</p>
<ul>
<li>
<code>lower_margin</code> : the lower margin relative to the bottom of the screen, i.e., the <code>y_bottom</code> cannot be closer to -1 than that.</li>
<li>
<code>upper_margin</code> : the upper margin relative to the top of the screen, i.e., the <code>y_top</code> cannot be closer to 1 than that.</li>
<li>
<code>min_size</code> : the minimal size of the opening, i.e., minimal distance between <code>y_top</code> and <code>y_bottom</code>.</li>
<li>
<code>max_size</code> : the maximal size of the opening, i.e., maximal distance between <code>y_top</code> and <code>y_bottom</code>.</li>
</ul>
<p>Write a code that assume certain values for each parameter (e.g., <code>lower_margin = 0.2</code>, <code>upper_margin = 0.2</code>, <code>min_size = 0.2</code>, <code>max_size = 0.4</code>) and generates a random pair <code>(y_bottom, y_top)</code> that satisfies the conditions.</p>
<div class="rmdnote practice">
<p>Write a random opening code in a Jupiter notebook.</p>
</div>
</div>
<div id="an-obstacle" class="section level2" number="12.14">
<h2>
<span class="header-section-number">12.14</span> An obstacle<a class="anchor" aria-label="anchor" href="#an-obstacle"><i class="fas fa-link"></i></a>
</h2>
<p>Now let us create an <code>Obstacle</code> class (put it into a separate file). It will consist of two rectangles, on protruding from the top and the other one from the bottom, with a random opening in between. At the moment you need six settings to describe an <code>Obstacle</code>: The four parameters that define a random opening plus a width of rectangles and their color. Describe them as a separate group in the settings files (probably under <code>"Obstacles"</code>) and pass them to the constructor of the <code>Obstacle</code> class.</p>
<p>In the constructor, generate a random opening (you have the code for this already) and create the two rectangles both <code>width</code> wide, one going from the top till <code>y_top</code>, another one from the bottom till <code>y_bottom</code>. Place both horizontally at the right edge of the window but so you could see them. Decide on how you will store the two rectangles, you can put them into two different attributes (e.g., <code>upper_rect</code> and <code>lower_rect</code>) or have them in a list. I would suggest the latter approach, as it will simplify your future code. Think about which parameters you need for the <code>__init__()</code> constructor function.</p>
<p>You also will need a <code>draw()</code> method that simply draws both rectangles. Implement the class in a separate file, then create and draw a single obstacle in the main code to check that it looks right.</p>
<div class="rmdnote program">
<p>Create <code>Obstacle</code> class in a separate file.<br>
Use it in <code>code07.py</code>.</p>
</div>
</div>
<div id="a-moving-obstacle" class="section level2" number="12.15">
<h2>
<span class="header-section-number">12.15</span> A moving obstacle<a class="anchor" aria-label="anchor" href="#a-moving-obstacle"><i class="fas fa-link"></i></a>
</h2>
<p>Conceptually, our bird fly towards an obstacle but instead we will induce perception of its motion by moving obstacles from right to left. Define a new <code>speed</code> setting for an <code>Obstacle</code> class, it should be in <code>norm units per second</code> and create an <code>update</code> method that would change horizontal position of both rectangles based on the amount of time that passed between the calls. This is similar to how we updated bird’s position based on its speed, so follow the same logic and think about which additional attributes you require and how you store and use any relevant information.</p>
<p>Call <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> at the same place that you update bird’s location in the main loop and check that the obstacle is moving from right to left.</p>
<div class="rmdnote program">
<p>Add <code>update</code> method to <code>Obstacle</code> class.<br>
Use it in <code>code08.py</code>.</p>
</div>
</div>
<div id="hitting-the-wall" class="section level2" number="12.16">
<h2>
<span class="header-section-number">12.16</span> Hitting the wall<a class="anchor" aria-label="anchor" href="#hitting-the-wall"><i class="fas fa-link"></i></a>
</h2>
<p>At the moment, our bird is flying through the obstacle like it is not there. But it is! Luckily for us, PsychoPy makes implementing this very easy, as it can check whether two stimuli overlap using <a href="https://psychopy.org/api/visual/shapestim.html#psychopy.visual.ShapeStim.overlaps">overlaps()</a> method of one of them (and the second stimulus is passed as an argument).</p>
<p>Thus, to check whether the bird hit the wall, we just need to create a method (let us call it <code>check_if_hit</code>) in an <code>Obstacle</code> class that will take a bird object and check whether it <a href="https://psychopy.org/api/visual/shapestim.html#psychopy.visual.ShapeStim.overlaps">overlaps()</a> with one of the rectangles. Remember, our <code>FlappyBird</code> is a descendant of the <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a>, so we can pass it to the <a href="https://psychopy.org/api/visual/shapestim.html#psychopy.visual.ShapeStim.overlaps">overlaps()</a> method directly (advantage of using the inheritance!)</p>
<p>In the main game loop, add the check for the bird <em>not</em> hitting the obstacle to the main condition (so now you should have three things to check for).
Test your code by flying the bird into the wall. Also, by flying your bird through the opening. Note that if our settings make it too tricky, modify them to make the opening larger.</p>
<div class="rmdnote program">
<p>Add <code>check_if_hit</code> method to <code>Obstacle</code> class.<br>
Use it in <code>code09.py</code>.</p>
</div>
</div>
<div id="an-obstacle-manager" class="section level2" number="12.17">
<h2>
<span class="header-section-number">12.17</span> An obstacle manager<a class="anchor" aria-label="anchor" href="#an-obstacle-manager"><i class="fas fa-link"></i></a>
</h2>
<p>A game with a single obstacle is no fun but before we add more, we need a class that will manage them for us. Let us call it <code>ObstaclesManager</code>. For the moment, it will simply wrap up all functionality that we implemented in the main script. In the constructor, it should create a <em>list</em> attribute for obstacle object and add a first one, it should also implement methods <code>draw()</code>, <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>, and <code>check_if_hit()</code> that draws, update, and checks for an overlap with a bird for <em>all</em> obstacles on the list. For the moment we will still have just one of them in the list but implementing things in the loop means it will be easier to add more. Create the class and then use it in the main script.</p>
<p>There should be no actual changes how the game plays, just the code refactoring. However, it helps us to hide the management part from the main script (making it easier to understand) and, if you did everything correctly, the code should “just work” once you replace <code>Obstacle</code> with <code>ObstaclesManager</code> object.</p>
<div class="rmdnote program">
<p>Create <code>ObstaclesManager</code> class.<br>
Use it in <code>code10.py</code>.</p>
</div>
</div>
<div id="loads-of-obstacles" class="section level2" number="12.18">
<h2>
<span class="header-section-number">12.18</span> Loads of obstacles<a class="anchor" aria-label="anchor" href="#loads-of-obstacles"><i class="fas fa-link"></i></a>
</h2>
<p>Now we are ready to add more obstacles. You need to update the <code>update</code> method of the <code>ObstaclesManager</code> so that add a new obstacle to the list after a random time interval. Define a new settings <code>Spawn time</code>, a list of two values that define a minimal and maximal time between spawns, and create a <a href="https://psychopy.org/api/clock.html#psychopy.clock.CountdownTimer">CountdownTimer</a> (or a <a href="https://psychopy.org/api/clock.html#psychopy.clock.Clock">Clock</a>, remember they differ only in whether time is subtracted or added) attributed. Whenever the timer is up, add a new obstacle to the list, generate a new delay, and set the timer again. Note that now you need settings and a Window in the <code>update</code> because they are required for creating a new obstacle. Think how you can store them for later use in the constructor.</p>
<p>Do you need to change anything in the main script? Check that more obstacles appear over time!</p>
<div class="rmdnote program">
<p>Update <code>update</code> of the <code>ObstaclesManager</code> class.<br></p>
</div>
</div>
<div id="removing-redundant-obstacles" class="section level2" number="12.19">
<h2>
<span class="header-section-number">12.19</span> Removing redundant obstacles<a class="anchor" aria-label="anchor" href="#removing-redundant-obstacles"><i class="fas fa-link"></i></a>
</h2>
<p>Once the obstacle is past the left edge of the screen (its x-axis position is less than <code>-1</code>) we need to remove it from the list. Otherwise, we will waste a lot of time and memory keeping track and drawing obstacles that are neither relevant, nor visible. Think about how you would implement this before reading further.</p>
<p>First, we need to compute the horizontal position of an obstacle. You can deduce it from <code>pos</code> attribute of one of the rectangles and implement this use of attribute (<code>pos</code> of <code>Obstacle</code>) of an attribute (<code>obstacles</code> of <code>ObstaclesManager</code>) directly. However, working with attributes of attributes makes code harder to read and to maintain. Instead, add a new computed property <code>x</code> to <code>Obstacle</code> class that would return a single number (horizontal position) using <code>@property</code> decorator we used for the bird’s <code>is_airborne</code> dynamic attribute.</p>
<p>Update the <code>update</code> method of the <code>ObstaclesManager</code> to check the position the <em>first</em> obstacle in the list. If it less than -1, simply <a href="https://docs.python.org/3.1/tutorial/datastructures.html">pop</a> it from the list. Why the first one? Because any other obstacle in the list was added later and, therefore, must be further to the right. Why <em>only</em> the first one? If we assume both a reasonable motion speed and a reasonable spawn delay, it is very unlikely that more than one obstacles reaches the left edge at the same time.</p>
<p>Note that for safety reasons, you must first check that the <code>obstacles</code> attribute is not empty! Hint, when used in a conditional statement directly, empty list evaluates to <code>False</code>. Debug the code to make sure that obstacles are indeed removed. You can either use a different cut-off point (e.g., -0.25) to see that easier or put a break point at the line that pops the redundant obstacle (better still, do both!)</p>
<div class="rmdnote program">
<p>Update <code>update</code> of the <code>ObstaclesManager</code> class.</p>
</div>
</div>
<div id="keeping-the-score" class="section level2" number="12.20">
<h2>
<span class="header-section-number">12.20</span> Keeping the score<a class="anchor" aria-label="anchor" href="#keeping-the-score"><i class="fas fa-link"></i></a>
</h2>
<p>It is hard to brag about your bird-flying skills, if you do not how many obstacles did you fly through. Let us add the score! First, create a <a href="https://psychopy.org/api/visual/textstim.html#psychopy.visual.TextStim">TextStim</a> (call it <code>score_text</code>) and put it somewhere one the screen, e.g., a top-left or top-right corner. Initialize its text to <code>"0"</code>. Draw it in the main loop. Make sure it works before you continue.</p>
<p>To keep the score, we need to count the number of obstacles that the bird clears on every frame and add it to the total score. As with the removal of redundant obstacles, it will be either zero or one obstacle that crossed the middle of the screen. But in this case, it is not the leftmost that we have to check but the <em>leftmost</em> among those that did not yet cross the mid-line. There are different way you can approach this, so think how you would approach this before reading on. And if you came up with a different plan, by all means – implement it!</p>
<p>My way of doing this is to introduce a new attribute <code>scored = False</code> and a method <code>score()</code> to the <code>Obstacle</code> class. In the <code>score()</code> method, if the object crossed the <code>0</code> line <em>and</em> has not been scored, it marked as <code>scored</code> and the method returns <code>1</code>. Otherwise, the object was either already scored or did not cross the mid-line yet, so it returns <code>0</code>. Next, I added a <code>score()</code> method to the <code>ObstaclesManager</code> that simply computes the total score (sum of) scores of all obstacles in the list. In the main script this score is added to a <code>score</code> variable that, in turn, is used to update <code>score_text</code>.</p>
<div class="rmdnote program">
<p>Update your code and<br>use it in <code>code11.py</code>.</p>
</div>
</div>
<div id="a-foundation" class="section level2" number="12.21">
<h2>
<span class="header-section-number">12.21</span> A foundation<a class="anchor" aria-label="anchor" href="#a-foundation"><i class="fas fa-link"></i></a>
</h2>
<p>This is just a foundation of a game, so feel free to add to it. Animated bird? Difficulty levels? Different kinds of obstacles? High-score table?</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="christmas-special.html"><span class="header-section-number">11</span> Christmas special</a></div>
<div class="next"><a href="seminar-02-06.html"><span class="header-section-number">13</span> Guitar Hero: staircase and iterator functions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#flappy-bird"><span class="header-section-number">12</span> Flappy Bird</a></li>
<li><a class="nav-link" href="#chapter-concepts-7"><span class="header-section-number">12.1</span> Chapter concepts</a></li>
<li>
<a class="nav-link" href="#object-oriented-programming"><span class="header-section-number">12.2</span> Object-oriented programming</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#classes-and-objects-instances-of-classes"><span class="header-section-number">12.2.1</span> Classes and objects (instances of classes)</a></li>
<li><a class="nav-link" href="#encapsulation"><span class="header-section-number">12.2.2</span> Encapsulation</a></li>
<li><a class="nav-link" href="#inheritance-generalization"><span class="header-section-number">12.2.3</span> Inheritance / Generalization</a></li>
<li><a class="nav-link" href="#polymorphism"><span class="header-section-number">12.2.4</span> Polymorphism</a></li>
<li><a class="nav-link" href="#a-minimal-class-example"><span class="header-section-number">12.2.5</span> A minimal class example</a></li>
<li><a class="nav-link" href="#add-method"><span class="header-section-number">12.2.6</span> add method</a></li>
<li><a class="nav-link" href="#flexible-accumulator-with-a-subtract-method"><span class="header-section-number">12.2.7</span> Flexible accumulator with a subtract method</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#method-arguments"><span class="header-section-number">12.3</span> Method arguments</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#constructor-arguments"><span class="header-section-number">12.3.1</span> Constructor arguments</a></li>
<li><a class="nav-link" href="#calling-methods-from-other-methods"><span class="header-section-number">12.3.2</span> Calling methods from other methods</a></li>
<li><a class="nav-link" href="#local-variables"><span class="header-section-number">12.3.3</span> Local variables</a></li>
</ul>
</li>
<li><a class="nav-link" href="#flappy-bird-the-humble-beginnings"><span class="header-section-number">12.4</span> Flappy Bird: the humble beginnings</a></li>
<li><a class="nav-link" href="#flappy-bird-class"><span class="header-section-number">12.5</span> Flappy Bird class</a></li>
<li><a class="nav-link" href="#a-properly-sized-bird"><span class="header-section-number">12.6</span> A properly-sized bird</a></li>
<li><a class="nav-link" href="#flappy-bird-is-falling-down-my-dear-lady"><span class="header-section-number">12.7</span> Flappy Bird is falling down (my dear lady)</a></li>
<li><a class="nav-link" href="#timing-the-fall"><span class="header-section-number">12.8</span> Timing the fall</a></li>
<li><a class="nav-link" href="#it-is-all-newtons-fault"><span class="header-section-number">12.9</span> It is all Newton’s fault</a></li>
<li><a class="nav-link" href="#flap-bird-flap"><span class="header-section-number">12.10</span> Flap bird, flap!</a></li>
<li><a class="nav-link" href="#stay-off-the-ground"><span class="header-section-number">12.11</span> Stay off the ground</a></li>
<li><a class="nav-link" href="#computed-attribute-property"><span class="header-section-number">12.12</span> Computed attribute @property</a></li>
<li><a class="nav-link" href="#an-opening-in-an-obstacle"><span class="header-section-number">12.13</span> An opening in an obstacle</a></li>
<li><a class="nav-link" href="#an-obstacle"><span class="header-section-number">12.14</span> An obstacle</a></li>
<li><a class="nav-link" href="#a-moving-obstacle"><span class="header-section-number">12.15</span> A moving obstacle</a></li>
<li><a class="nav-link" href="#hitting-the-wall"><span class="header-section-number">12.16</span> Hitting the wall</a></li>
<li><a class="nav-link" href="#an-obstacle-manager"><span class="header-section-number">12.17</span> An obstacle manager</a></li>
<li><a class="nav-link" href="#loads-of-obstacles"><span class="header-section-number">12.18</span> Loads of obstacles</a></li>
<li><a class="nav-link" href="#removing-redundant-obstacles"><span class="header-section-number">12.19</span> Removing redundant obstacles</a></li>
<li><a class="nav-link" href="#keeping-the-score"><span class="header-section-number">12.20</span> Keeping the score</a></li>
<li><a class="nav-link" href="#a-foundation"><span class="header-section-number">12.21</span> A foundation</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy/blob/master/10-flappy-bird.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy/edit/master/10-flappy-bird.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Writing games with Python and PsychoPy</strong>" was written by Alexander (Sasha) Pastukhov. It was last built on 2022-10-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
