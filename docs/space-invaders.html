<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 16 Space invaders: mixins and duck typing | Writing games with Python and PsychoPy</title>
<meta name="author" content="Alexander (Sasha) Pastukhov">
<meta name="description" content="Today we will program a classic Space Invaders game with a twist. We will be using object-oriented programming but you will learn about mixins and duck typing. Previously, you have learned how to...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 16 Space invaders: mixins and duck typing | Writing games with Python and PsychoPy">
<meta property="og:type" content="book">
<meta property="og:url" content="https://alexander-pastukhov.github.io/writing-games-with-python-and-psychopy/space-invaders.html">
<meta property="og:description" content="Today we will program a classic Space Invaders game with a twist. We will be using object-oriented programming but you will learn about mixins and duck typing. Previously, you have learned how to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 16 Space invaders: mixins and duck typing | Writing games with Python and PsychoPy">
<meta name="twitter:description" content="Today we will program a classic Space Invaders game with a twist. We will be using object-oriented programming but you will learn about mixins and duck typing. Previously, you have learned how to...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.13/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Writing games with Python and PsychoPy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="software.html"><span class="header-section-number">2</span> Software</a></li>
<li><a class="" href="programming-tips.html"><span class="header-section-number">3</span> Programming tips and tricks</a></li>
<li><a class="" href="python-basics.html"><span class="header-section-number">4</span> Python basics</a></li>
<li><a class="" href="guess-the-number-single-round.html"><span class="header-section-number">5</span> Guess the Number: a single round edition</a></li>
<li><a class="" href="guess-the-number-multi-round.html"><span class="header-section-number">6</span> Guess the Number: a multi round edition</a></li>
<li><a class="" href="guess-the-number-ai.html"><span class="header-section-number">7</span> Guess the Number: AI takes a turn</a></li>
<li><a class="" href="psychopy-basics.html"><span class="header-section-number">8</span> Gettings started with PsychoPy</a></li>
<li><a class="" href="whack-a-mole.html"><span class="header-section-number">9</span> Whack-a-Mole</a></li>
<li><a class="" href="memory-game.html"><span class="header-section-number">10</span> Memory game</a></li>
<li><a class="" href="christmas-special.html"><span class="header-section-number">11</span> Christmas special</a></li>
<li><a class="" href="flappy-bird.html"><span class="header-section-number">12</span> Flappy Bird</a></li>
<li><a class="" href="seminar-02-06.html"><span class="header-section-number">13</span> Guitar Hero: staircase and iterator functions</a></li>
<li><a class="" href="the-snake.html"><span class="header-section-number">14</span> The Snake</a></li>
<li><a class="" href="moon-lander.html"><span class="header-section-number">15</span> Moon lander</a></li>
<li><a class="active" href="space-invaders.html"><span class="header-section-number">16</span> Space invaders: mixins and duck typing</a></li>
<li><a class="" href="game-of-life-numpy.html"><span class="header-section-number">17</span> Game of life (NumPy)</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="space-invaders" class="section level1" number="16">
<h1>
<span class="header-section-number">16</span> Space invaders: mixins and duck typing<a class="anchor" aria-label="anchor" href="#space-invaders"><i class="fas fa-link"></i></a>
</h1>
<p>Today we will program a classic Space Invaders game with a twist. We will be using object-oriented programming but you will learn about <em>mixins</em> and <em>duck typing</em>. Previously, you have learned how to ensure generalization — common behavior for different classes — via inheritance. E.g., when all visual stimuli inherit from the save <code>BaseVisualStim</code> class, you can be sure that they all have <code>size</code>, <code>ori</code>, and <code>pos</code> properties and that you can <code>draw()</code> them. However, this approach may not be best suited for cases when the same class must implement several different behaviours. One solution is to use <em>multiple inheritance</em>, so that a class is a descendant of several classes and, thus, get behavior from many of them. This is the canonical way of ensuring generalization but you can achieve same means differently.</p>
<div id="mixins" class="section level2" number="16.1">
<h2>
<span class="header-section-number">16.1</span> Mixins<a class="anchor" aria-label="anchor" href="#mixins"><i class="fas fa-link"></i></a>
</h2>
<p>One way to infuse a <em>common</em> behavior into <em>different</em> classes is via a mixin classes. These are classes that only define a single <em>behavior</em> (i.e., a method) and nothing else. No constructor and, typically, no attributes. Thus, they are too limited to be used on their own but can be inherited from (mixed into the proper class) enabling that single behavior in the descendant.</p>
<p>Think about all creatures that can fly: insects, birds, bats, astronauts, etc. They do have a common ancestor but that common ancestor did not have the ability to fly. Instead, each line evolved that ability independently and all have evolutionary “cousins” that cannot fly. When programming, you can follow the same pattern of creating a common ancestor for flying and non-flying insects, then implementing ability to fly in the former. Do the same for birds, bats, astronauts, etc. If your implementation must be very detailed and creature-specific, this might be unavoidable. However, if your ability to “fly” is very abstract and, therefore, the same for all creatures in question, you will end up writing the same code for every insect, bird, bat class. An easy copy-paste, of course, but that means you get multiple places with identical implementation, so when you need to change it, you will have to make sure that you do it in all the places (and you gonna miss some, I always do). Alternative? Mixins! You create a class <code>FlightAbility</code> that implements that common abstract “flying” and, then, you inherit from that class whenever you need a flying someone. Mix a non-flying bird with the <code>FlightAbility</code> and it can fly! Mix it with an insect: Flying insect! You may also mix in more than one ability. Again, start with a bird that just walks around (a chicken). Add a mixin <code>FlightAbility</code> and you get a flying bird (a pigeon). Take the walking bird again and mix in <code>SwimAbility</code> and you get a swimming bird (a penguin). Mix in <em>both</em> and you get a bird that can both fly and swim (a swan)!</p>
<p>You may not need mixins frequently but they are a powerful way of creating an isolated behavior that different classes might need without enforcing strict inheritance structure. PsychoPy is big on mixins. For example, it has <code>ColorMixin</code> that could be mixed-in to a visual class that needs to work with color, so it implements all the repetitive<a href="game-of-life-numpy.html#fn91" class="footnote-ref" id="fnref91"><sup>91</sup></a> code for translating an arbitrary color representation (string, hexadecimal code, RGB triplet, HSL triplet, single grayscale value, etc.) into the internal RGB color value. It also has <code>TextureMixin</code> for classes that use textures for drawing objects. In our <em>Space Invaders</em> game, we will use a Mixin class to mix in a “boom sound when exploded” behavior, common to both aliens and the player’s ship.</p>
</div>
<div id="duck-typing" class="section level2" number="16.2">
<h2>
<span class="header-section-number">16.2</span> Duck typing<a class="anchor" aria-label="anchor" href="#duck-typing"><i class="fas fa-link"></i></a>
</h2>
<p>Alternatively, you might need your object to behave in a certain way but having a proper class hierarchy is an overkill because this is only one class and you might want some but not all the functionality. The idea is to use “duck typing”, which comes from saying “If it walks like a duck, and it quacks like a duck, then it must be a duck.” In other words, if the only things you care about are walking and quacking, do you need it to be an actual duck<a href="game-of-life-numpy.html#fn92" class="footnote-ref" id="fnref92"><sup>92</sup></a>? Will a goose that can walk and quack the same way do? Will a <em>dog</em> that can walk and quack like a duck do? Obviously, the correct answer is “it depends” but in a lot of situations you are interested in a common behavior rather than in a common ancestor.</p>
<p>Duck typing is a popular method in Python. For example, <code>len(object)</code> is a canonical way to compute length of an object. That object could be a string <code>len("four")</code>, or a list <code>len([1, 2, 3, 4])</code>, a tuple <code>len(tuple(1, 4, 2))</code>, a dictionary <code>len({"A": 1, "B": 5})</code>, etc. The idea is that as long as a class has a concept of length (number of elements, number of characters, etc.), you should be able compute its length via <code>len()</code>. This is achieved by adding a <em>special method</em> to the class <code>__len__(self)</code> that must return an integer. This is called a “hook method”, as it is never called directly but is “hooked” to the <code>len()</code> function call. Thus, whenever you write <code>len(object)</code>, it is actually translated into <code>object.__len()__</code><a href="game-of-life-numpy.html#fn93" class="footnote-ref" id="fnref93"><sup>93</sup></a>.</p>
<p>Another popular duck typing application is an implementation of an iterator: an object that yields one item at a time, so you can do lazy computation<a href="game-of-life-numpy.html#fn94" class="footnote-ref" id="fnref94"><sup>94</sup></a> or loop over them. You already know how to implement an <a href="seminar-02-06.html#iteratorgenerator-functions">iterator as a function</a> but it also be defined as a class with two special methods: <code>__iter__(self)</code> and <code>__next__(self)</code>. The former is called when iteration starts and it should perform a necessary initialization (e.g., setting internal counter to 0, shuffling elements, etc.) and must return an <em>iterator object</em> (typically, a reference to itself). The <code>__next()__</code> method is called whenever the next item is needed: if you use iterator in the <code>for</code> loop, it is called automatically or you can call it yourself via <code>next(iterator_object)</code>. <code>__next()__</code> must return the next item or <a href="https://docs.python.org/3/reference/simple_stmts.html#the-raise-statement">raise</a> a <a href="https://docs.python.org/3/library/exceptions.html#StopIteration">StopIteration</a> <a href="moon-lander.html#exceptions">exception</a>, signalling that it ran out of items.</p>
<p>Note that an iterator does not require an implementation of the <code>__len()__</code> method! How come? If you have items you can iterate over, doesn’t it make sense to also know how many (length of an object)? Not necessarily! First, if you use an iterator in a <code>for</code> loop and you just want to iterate over all of the items until you run out of them (which is signaled by the <a href="https://docs.python.org/3/library/exceptions.html#StopIteration">StopIteration</a> exception). Thus, their total number and, hence, <code>len()</code> method is of little interest. Accordingly, why implement a function that you do not need<a href="game-of-life-numpy.html#fn95" class="footnote-ref" id="fnref95"><sup>95</sup></a>? Second, what if your iterator is endless (in that case, it is called a <em>generator</em>)? E.g., every time <code>__next__()</code> is called it returns one random item or a random number. This way, it will never run out of items, so the question of “what is its length” is meaningless unless you take “infinity” as an answer. This lack of need for <code>__len__()</code> for iterators is the spirit of duck typing: implement only the methods you need for your duck, ignore the rest.</p>
<p>Below, you will practice duck typing by implementing both <code>__len()__</code> and two special iterator methods as part of our <code>AlienArmada</code> class.</p>
</div>
<div id="which-one-to-use" class="section level2" number="16.3">
<h2>
<span class="header-section-number">16.3</span> Which one to use?<a class="anchor" aria-label="anchor" href="#which-one-to-use"><i class="fas fa-link"></i></a>
</h2>
<p>Now you know <em>three</em> methods to produce common behavior: proper inheritance, mixins, and duck typing. Which one should you use? Depends on what you need. If you have many classes and you can have a well defined inheritance tree, use it. However, if you have some specific behavior that you need in some classes that is hard to fit with the inheritance tree, use mixins. If you have a single class that needs very specific functionality, such as an iterator: use duck typing. Using any one of them does not preclude you using others, but be moderate, using too many different paradigms will be confusing for you and a reader.</p>
</div>
<div id="space-invaders-1" class="section level2" number="16.4">
<h2>
<span class="header-section-number">16.4</span> Space Invaders<a class="anchor" aria-label="anchor" href="#space-invaders-1"><i class="fas fa-link"></i></a>
</h2>
<p>We will program a simple version of the game with a gradually descending alien armada. Your task is to capture all aliens by firing a teleport beam before one of them rams your ship or gets away. Below, you can see my version of the game.</p>
<div style="text-align:center;">
<video controls><source src="videos/space-invaders.mp4" type="video/mp4"></source></video>
</div>
<p>As per usual, the plan is to move slowly in small steps to keep complexity of changes low. Here are the steps:</p>
<ul>
<li>Start with our usual PsychoPy boilerplate hidden in a context manager.</li>
<li>Add a <code>Spaceship</code> and use mouse to move it along the bottom of the screen.</li>
<li>Create an <code>Alien</code> and then the whole <code>AlienArmada</code>.</li>
<li>Add <code>Laser</code>, then a <code>LaserGun</code>, so that the player can fire many laser shots by pressing left mouse key.</li>
<li>Add check for hitting aliens with the laser and teleporting them off the screen.</li>
<li>Use mixin to add teleport sound.</li>
<li>Use cool iterators to cycle through lasers and aliens.</li>
<li>Make alien armada move.</li>
<li>Check for end-of-game.</li>
</ul>
<p>Before we start, grab images that we will use for the game <a href="material/space-invaders.zip">space-invaders.zip</a>, created specifically for our seminar by Andrej Pastukhov, who said you absolutely must look at this link: <a href="https://youtu.be/dQw4w9WgXcQ">Wie die Pixelarts meines Sohnes Andrej entstanden sind</a><a href="game-of-life-numpy.html#fn96" class="footnote-ref" id="fnref96"><sup>96</sup></a>.</p>
</div>
<div id="boilerplate-2" class="section level2" number="16.5">
<h2>
<span class="header-section-number">16.5</span> Boilerplate<a class="anchor" aria-label="anchor" href="#boilerplate-2"><i class="fas fa-link"></i></a>
</h2>
<p>Create our usual boilerplate with an external settings file via a context manager with <code>GameAbort</code> exception handling. You can reuse the code from our last game but I strongly suggest checking that you understand every step. My suggestion for the window size is 640×480 because the sprites are 32×32 but chose whatever looks good on your screen.</p>
<div class="rmdnote program">
<p>Create <code>GameContext</code> and <code>GameAbort</code> classes.<br>
Put your boilerplate code into <em>code01.py</em>.</p>
</div>
</div>
<div id="the-spaceship" class="section level2" number="16.6">
<h2>
<span class="header-section-number">16.6</span> The spaceship<a class="anchor" aria-label="anchor" href="#the-spaceship"><i class="fas fa-link"></i></a>
</h2>
<p>Create a new file for <code>Spaceship</code> class. It is remarkably boring as it just an image that moves left-right on a horizontal line. Thus, we will create it as a descendant of <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> class. The only method that you need to define right now is the constructor <code>__init__()</code>. It should take <a href="https://psychopy.org/api/visual/window.html#psychopy.visual.Window">Window</a> and image filename (should be stored in settings) as parameters (plus the compulsory <code>self</code>, of course) and call <code>super().__init__(...)</code> to initialize itself via the inherited constuctor. Apart from the two parameters you have, you also need to specify the initial position of the ship via <code>pos</code>. The ship should be somewhere just above the lower edge of the window. For me, vertical position of -0.9 worked quite nicely.</p>
<p>In the main code, create an object and draw it in the main loop.</p>
<div class="rmdnote program">
<p>Create <code>Spaceship</code> class in a separate file.<br>
Use it in <em>code02.py</em>.</p>
</div>
</div>
<div id="the-spaceship-moves" class="section level2" number="16.7">
<h2>
<span class="header-section-number">16.7</span> The spaceship moves<a class="anchor" aria-label="anchor" href="#the-spaceship-moves"><i class="fas fa-link"></i></a>
</h2>
<p>Now, let us use the <a href="https://psychopy.org/api/event.html#psychopy.event.Mouse">mouse</a> to control the horizontal position of the ship and, later on, left button to shoot. First, initialize the mouse in the context manager, so that it is one its attributes (then you can use it as <code>ctx.mouse</code>). Then, in the main loop, use <a href="https://psychopy.org/api/event.html#psychopy.event.Mouse.getPos">getPos()</a> method to get the position of the mouse and use the <em>horizontal</em> component to alter the position of the ship. Note that you <em>cannot</em> assign just a horizontal or vertical components to the position via <code>.pos[0] = ...</code>. In my PsychoPy 2021.1.4 it does not generate an error but does not change the actual position either. Thus, you need to assign a tuple of <code>(new horizontal component, original vertical component)</code> (the ship should stay at the same vertical position throughout the game). Test moving your spaceship around. You can make mouse invisible (see <a href="https://psychopy.org/api/event.html#psychopy.event.Mouse">documentation</a>) to make it more immersive.</p>
<div class="rmdnote program">
<p>Add mouse to <code>GameContext</code><br>
Use mouse to move ship in <em>code03.py</em>.</p>
</div>
</div>
<div id="an-alien-appears" class="section level2" number="16.8">
<h2>
<span class="header-section-number">16.8</span> An alien appears<a class="anchor" aria-label="anchor" href="#an-alien-appears"><i class="fas fa-link"></i></a>
</h2>
<p>Before we create an alien armada, let us create a single alien. The class will be very basic, which is why, we will put both <code>Alien</code> and <code>AlienArmada</code> into the same file (so, think about its filename). The class itself is similar to the <code>Spaceship</code>. The only differences are that it should take (and pass) <code>pos</code> parameter (unlike the spaceship that always appears at the same location) and that the image should be <a href="https://docs.python.org/3/library/random.html#random.choice">randomly picked</a> from a tuple of filenames (<em>alien-1.png</em> and <em>alien-2.png</em>, the names should be defined in the settings in an “aliens” group of settings). For testing, place a few aliens at arbitrary locations on the screen to check that an alien image is randomly picked. Do not forget to draw them in the main loop.</p>
<div class="rmdnote program">
<p>Create an <code>Alien</code> class<br>
Use them in <em>code04.py</em>.</p>
</div>
</div>
<div id="using-names-to-indicate-access-restrictions" class="section level2" number="16.9">
<h2>
<span class="header-section-number">16.9</span> Using names to indicate access restrictions<a class="anchor" aria-label="anchor" href="#using-names-to-indicate-access-restrictions"><i class="fas fa-link"></i></a>
</h2>
<p>Before we create an alien armada, we need to make a quick detour to talk about <a href="https://peps.python.org/pep-0008">naming conventions</a> for attributes and names of classes. Unlike most other languages, Python does not have private attributes or methods, i.e., attributes or methods accessible only from inside the object. If you come from Java or C#/C++, a thought that you can call <em>any</em> method and modify <em>any</em> attribute from outside should give you chills, as it becomes impossible to predict object’s behavior. Python “solves” the access problem via a “gentlemen’s agreement” that methods and attributes whose names start either with <code>__</code> or <code>_</code> should be <em>considered</em> private. In other words, you should not use them directly. In case of <code>__</code>, you are also prevented from doing it in a straightforward way, as the name is <a href="https://peps.python.org/pep-0008/#descriptive-naming-styles">mangled</a>. In the example below, you cannot access the <code>__color</code> attribute directly:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="space-invaders.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExampleClass:</span>
<span id="cb129-2"><a href="space-invaders.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb129-3"><a href="space-invaders.html#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.__color <span class="op">=</span> <span class="st">"red"</span></span>
<span id="cb129-4"><a href="space-invaders.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="space-invaders.html#cb129-5" aria-hidden="true" tabindex="-1"></a>example <span class="op">=</span> ExampleClass()</span>
<span id="cb129-6"><a href="space-invaders.html#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="space-invaders.html#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"># raises AttributeError</span></span>
<span id="cb129-8"><a href="space-invaders.html#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(example.__color)</span>
<span id="cb129-9"><a href="space-invaders.html#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in py_call_impl(callable, dots$args, dots$keywords): AttributeError: 'ExampleClass' object has no attribute '__color'</span></span>
<span id="cb129-10"><a href="space-invaders.html#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb129-11"><a href="space-invaders.html#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Detailed traceback:</span></span>
<span id="cb129-12"><a href="space-invaders.html#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   File "&lt;string&gt;", line 1, in &lt;module&gt;</span></span></code></pre></div>
<p>But as Python does not have truly private attributes, you can still access it via its mangled name<code>object._&lt;ClassName&gt;&lt;hidden attribute name&gt;</code>:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="space-invaders.html#cb130-1" aria-hidden="true" tabindex="-1"></a>example._ExampleClass__color</span>
<span id="cb130-2"><a href="space-invaders.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'red'</span></span></code></pre></div>
<p>However, this is a last resort sort of thing that you should use only if you absolutely must access that attribute or method and, hopefully, know what you doing.</p>
<p>As noted above, you can also come across attributes with a <em>single</em> leading underscore in the name, e.g. <code>_color</code>. This is a weak “internal use” indicator, so they are fully visible. However, the leading underscore does <em>hint</em> that this attribute or method should be <em>considered</em> private. So, if you see an attribute like <code>_color</code>, you should pretend that you know not of its existence and, therefore, you never read or modify it directly. Of course, this is only an <em>agreement</em>, so you can always ignore it and work with that attribute directly<a href="game-of-life-numpy.html#fn97" class="footnote-ref" id="fnref97"><sup>97</sup></a>. However, this almost certainly will break the code in unexpected and hard-to-trace ways.</p>
</div>
<div id="an-alien-armada-appears" class="section level2" number="16.10">
<h2>
<span class="header-section-number">16.10</span> An alien armada appears<a class="anchor" aria-label="anchor" href="#an-alien-armada-appears"><i class="fas fa-link"></i></a>
</h2>
<p>One alien is neither scary, nor challenging enough. We want more! For this, we will create an <code>AlienArmada</code> class with a twist. It will be responsible for creating a grid of aliens, moving them around (our chance to learn about special setter methods), allowing outside processes to iterate over them (iterator duck typing), and reporting the number of remaining aliens (length duck typing). As usual, we will do this one step at a time.</p>
<p>Start by creating an <code>AlienArmada</code> class, below the <code>Alien</code> class. Our initial version will the following methods</p>
<ul>
<li>a compulsory constructor,</li>
<li>
<code>spawn()</code> that creates and places individual aliens,</li>
<li>
<code>draw()</code> that draws aliens,</li>
</ul>
<p>and attributes</p>
<ul>
<li>
<code>win</code> a PsychoPy window,</li>
<li>
<code>__pos</code> that is a tuple with the position of the armada center within the window,</li>
<li>
<code>aliens</code> which is a list with alien objects.</li>
</ul>
<p>You must also expand your settings. By now you should already have an <code>Aliens</code> settings section with alien images’ filenames. To define the armada, we need also need to add</p>
<ul>
<li>
<code>"Initial position"</code>: center of the armada, I’ve picked <code>[0, 0.5]</code> but you can always optimize it later on.</li>
<li>
<code>"Grid size"</code>: number of aliens horizontally and vertically, I’ve used `[7, 3].</li>
<li>
<code>"Grid step [norm]"</code>: distance between aliens in “norm” units, I’ve picked 0.2.</li>
</ul>
<p><em>Constructor</em>: we will create and place aliens in a separate method <code>spawn()</code>, so our constructor will be very simple. As far as parameters are concerned, you need to pass a <a href="https://psychopy.org/api/visual/index.html">Window</a> for creating <code>Alien</code> objects and a dictionary with armada-specific settings. Store both of them as attributes for later use, initialize <code>__pos</code> to the <code>"Initial position"</code>, initialize <code>aliens</code> to an empty list and <code>spawn()</code> them (again, all attributes must be initialized in the constructor, even if to an empty list or <code>None</code>).</p>
<p>In the <code>spawn()</code> create aliens on a grid based on your <code>"Grid size"</code> and <code>"Grid step [norm]"</code> settings, so they are centered at <code>AlienArmada</code>’s position (<code>__pos</code>). All aliens go to <code>aliens</code> attribute, of course. Remember that they need a list of file names for visuals but you have it covered as you have them in the settings. It should look like this:</p>
<div class="inline-figure"><img src="images/alien-armada.png" width="320" style="display: block; margin: auto;"></div>
<div class="rmdnote program">
<p>Create the <code>AlienArmada</code> class.<br>
Use it in <em>code05.py</em>.</p>
</div>
</div>
<div id="a-laser-shot-appears" class="section level2" number="16.11">
<h2>
<span class="header-section-number">16.11</span> A laser shot appears<a class="anchor" aria-label="anchor" href="#a-laser-shot-appears"><i class="fas fa-link"></i></a>
</h2>
<p>Now we need to create <code>Laser</code> class (in a separate file). Eventually, when a player presses left mouse button, the laser should appear at the location just above the ship and fly up with a certain speed. As per usual, all parameters for laser (and <code>LaserCannon</code>) should be stored in the settings file under a separate section (e.g., <code>laser</code>). For the moment, we only need to specify <code>speed [norm/sec]</code> (laser shot speed in norm units per second, I’ve picked 1 norm / second, so it takes 2 seconds for the shot to fly across the screen)) and, optionally, filename of the laser bitmap (but that could be also hardcoded, as we have only one image).</p>
<p>Let us take care of the first step: creating a laser shot just above the sheep. Create <code>Laser</code> class as a descendant of <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim">ImageStim</a> (just like our <code>Spaceship</code> and <code>Alien</code> classes). It should take <code>win</code>, <code>pos</code>, and <code>speed</code> as arguments and call the ancestor constructor. The <code>pos</code> argument is the position of the ship (that fired it) but the laser must appear <em>above</em> it, so you need to adjust <code>pos[1]</code> for that (hint, you can get window height from <code>win.size[1]</code> and you know that sprites are 32 pixels high). The <code>speed</code> is in <em>norm units per second</em> from the settings. You need to save the <code>speed</code> value in an attribute for later use.</p>
<p>For testing, create a laser object right after you create the ship itself and draw it in the main loop. It won’t move but you will be able to see whether you’ve got the height right.</p>
<div class="rmdnote program">
<p>Create the <code>Laser</code> class.<br>
Use in <em>code06.py</em>.</p>
</div>
</div>
<div id="the-laser-shot-flies" class="section level2" number="16.12">
<h2>
<span class="header-section-number">16.12</span> The laser shot flies<a class="anchor" aria-label="anchor" href="#the-laser-shot-flies"><i class="fas fa-link"></i></a>
</h2>
<p>Let us add <code>fly()</code> method to the laser. It will be very simple, every time it is called the laser should move upwards. As in a Moonlander game, we need a <a href="https://psychopy.org/api/clock.html#psychopy.clock.Clock">clock</a> to measure the time elapsed between the updates, so create it as an attribute in the constructor. In the <code>fly()</code> method, you need to figure out the time elapsed since the last call or since the shot was created (don’t forget to reset the timer after that) and move the shot based on its <code>speed</code> and elapsed time.</p>
<p>Remember to call <code>fly()</code> method in the main loop and see how the laser flies up and off the screen.</p>
<div class="rmdnote program">
<p>Add <code>fly()</code> method to <code>Laser</code> class.<br>
Use it in <em>code07.py</em>.</p>
</div>
</div>
<div id="we-want-more-lasers" class="section level2" number="16.13">
<h2>
<span class="header-section-number">16.13</span> We want more lasers!<a class="anchor" aria-label="anchor" href="#we-want-more-lasers"><i class="fas fa-link"></i></a>
</h2>
<p>Now we will create a <code>LaserGun</code> class that will take care of individual laser shots. It will 1) create a new <code>Laser</code> object whenever we <code>fire()</code> from it, 2) ensure that it does not overheat by allowing only one shot every N seconds (another parameter to be defined in the settings file, let’s say 0.3 s), 3) call <code>draw()</code> and <code>fly()</code> methods for all laser shots. We will create the class <code>LaserGun</code> in the same file as the <code>Laser</code>.</p>
<p>In the constructor, pass PsychoPy window variable and a dictionary with laser gun specific settings (these should include the <code>speed</code> that you specified earlier and the cool down period in seconds) and store both in attributes for later use. Initialize <code>lasershots</code> attribute with empty list, and create a cool down <a href="https://psychopy.org/api/clock.html#psychopy.clock.CountdownTimer">timer</a>.</p>
<p>The <code>fire()</code> method should take position of the ship as a single parameter. If enough time passed since the last shot (check the cool down timer for that), create a new <code>Laser</code> at the supplied position, add it to the <code>lasershots</code> list, and reset the cool down timer. In <code>draw()</code>/<code>fly()</code> simply draw/fly all <code>lasershots</code>.</p>
<p>For testing, use <code>LaserGun</code> in place of the <code>Laser</code>. Both have same <code>draw()</code> and <code>fly()</code> methods that you should be calling already. In the main loop, check if left mouse button is <a href="https://psychopy.org/api/event.html#psychopy.event.Mouse.getPressed">pressed</a>. If it is, <code>fire()</code> the laser gun, passing current position of the ship to it.</p>
<div class="rmdnote program">
<p>Create <code>LaserGun</code> class.<br>
Test it in <em>code08.py</em>.</p>
</div>
</div>
<div id="too-many-lasers" class="section level2" number="16.14">
<h2>
<span class="header-section-number">16.14</span> Too many lasers!<a class="anchor" aria-label="anchor" href="#too-many-lasers"><i class="fas fa-link"></i></a>
</h2>
<p>We do not need our lasers once they fly of the screen, so we should remove them. First, we need to know which <code>Laser</code> shot has <code>expired</code>“: is off the screen (this section) or hit its target (the next section). For this, modify the <code>Laser</code> class by adding an <code>expired</code> attribute that is set initially to <code>False</code> (the shot is good). In addition, write a new method <code>check_screen_limits()</code> that would set <code>expired = True</code> if the shot is above the upper edge of the window but leaves <code>expired</code> as is (unmodified!) otherwise (the shot could be within the screen and get <code>expired</code> because it hit an alien).</p>
<p>Next, add a <code>cleanup()</code> method to the <code>LaserGun</code> class that will call <code>check_screen_limits()</code> for all shots and then remove all <code>expired</code> ones. This is both simple and tricky! Conceptually simple: you loop over <code>lasershots</code> and delete any object that is <code>expired</code>. The easy way is to do it via <a href="memory-game.html#list-comprehension">list comprehension</a> (deleting objects by not including them in the updated list) but for didactic reasons we will use <a href="https://docs.python.org/3/tutorial/datastructures.html#the-del-statement">del</a> instead. If you have a list and you want to delete a second element, you write</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="space-invaders.html#cb131-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb131-2"><a href="space-invaders.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> x[<span class="dv">1</span>]</span>
<span id="cb131-3"><a href="space-invaders.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb131-4"><a href="space-invaders.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1, 3, 4, 5]</span></span></code></pre></div>
<p>However, there is a catch. Imagine that you want to delete second and forth elements, so that the result should be <code>[1, 3, 5]</code>. If you just delete second and then forth elements, you won’t get what you want:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="space-invaders.html#cb132-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb132-2"><a href="space-invaders.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> x[<span class="dv">1</span>]</span>
<span id="cb132-3"><a href="space-invaders.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> x[<span class="dv">3</span>]</span>
<span id="cb132-4"><a href="space-invaders.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb132-5"><a href="space-invaders.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1, 3, 4]</span></span></code></pre></div>
<p>Do you see why? Solution: start deleting from the end, this way indexes of earlier elements won’t be affected:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="space-invaders.html#cb133-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb133-2"><a href="space-invaders.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> x[<span class="dv">3</span>]</span>
<span id="cb133-3"><a href="space-invaders.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> x[<span class="dv">1</span>]</span>
<span id="cb133-4"><a href="space-invaders.html#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb133-5"><a href="space-invaders.html#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1, 3, 5]</span></span></code></pre></div>
<p>Note that you must use <code>del list[index]</code> format, so you need to use indexing in the for loop of the <code>cleanup()</code> method:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="space-invaders.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ishot <span class="kw">in</span> backwards<span class="op">-</span>index<span class="op">-</span>built<span class="op">-</span>via<span class="op">-</span>the<span class="op">-</span><span class="bu">range</span><span class="op">-</span>function:</span>
<span id="cb134-2"><a href="space-invaders.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  check <span class="cf">if</span> lasershot has left the screen</span>
<span id="cb134-3"><a href="space-invaders.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">self</span>.lasershots[ishot] needs to be deleted:</span>
<span id="cb134-4"><a href="space-invaders.html#cb134-4" aria-hidden="true" tabindex="-1"></a>    delete that <span class="va">self</span>.lasershots[ishot]</span></code></pre></div>
<p>Add <code>cleanup()</code> call to the main loop right after the <code>fly()</code> to automatically delete expired shots. Once you fired a few shots and they are all off the screen, put a breakpoint and check that the <code>.lasershots</code> is empty (your <code>cleanup()</code> works as it should).</p>
<div class="rmdnote program">
<p>Add <code>expired</code> property to <code>Laser</code>.<br>
Add <code>cleanup()</code> method to <code>LaserShot</code>.<br>
Use <code>cleanup()</code> in <em>code09.py</em>.</p>
</div>
</div>
<div id="i-am-hit-i-am-hit" class="section level2" number="16.15">
<h2>
<span class="header-section-number">16.15</span> I am hit! I am hit!<a class="anchor" aria-label="anchor" href="#i-am-hit-i-am-hit"><i class="fas fa-link"></i></a>
</h2>
<p>Now we need to check whether a lasershot hit an alien. In that case, all the relevant aliens and shots must be removed. Removing lasershots is easy: We just set them as <code>expired</code> and <code>cleanup()</code> does the rest. Clearly, we need the same mechanism for the aliens.</p>
<p>Add <code>hit</code> attribute to the <code>Alien</code> class and initialize to <code>False</code> (an alien is not initially hit). In <code>AlienArmada</code> class, implement a <code>cleanup()</code> method, analogous to one in <code>LaserGun</code> that will delete any alien that is <code>hit</code>. Add the call to it in the main loop at the same location as for the <code>LaserGun</code>. You can test it by setting <code>hit</code> to <code>True</code> for one of the aliens and it should be missing.</p>
<p>Now for the actual check. You should loop over all aliens and laser shots attributes of <code>AlienArmada</code> and <code>LaserGun</code> checking <em>every pair</em> on whether they <a href="https://psychopy.org/api/visual/imagestim.html#psychopy.visual.ImageStim.overlaps">overlap</a>. If they do, set laser shot to <code>expired</code> and the alien as <code>hit</code>. Do this check <em>before</em> the clean up but <em>after</em> the laser shots fly.</p>
<p>Test it!</p>
<div class="rmdnote program">
<p>Update <code>Alien</code> and <code>AlienArmada</code> classes
Check for laser shots hitting aliens
in <em>code10.py</em>, .</p>
</div>
</div>
<div id="duck-typiing-iterators" class="section level2" number="16.16">
<h2>
<span class="header-section-number">16.16</span> Duck typiing iterators<a class="anchor" aria-label="anchor" href="#duck-typiing-iterators"><i class="fas fa-link"></i></a>
</h2>
<p>In the precious exercise, you used <code>aliens</code> and <code>lasershots</code> attributes directly in the loop. However, let us inject some coolness into our code and turn <code>AlienArmada</code> and <code>LaserGun</code> classes into iterators. Recall that you need to implement two special methods for this: <code>__iter__(self)</code> and <code>__next__(self)__</code>. The first one, initializes the loop, the second one yields the next item. The actual implementation is very simple. You need to create a new attribute that will be used to track which item you need to yield, call it <code>iter</code> and initialize it to <code>None</code> in the constructor.</p>
<p>In the <code>__iter__(self)</code>, initialize the counter to <code>0</code> and return <code>self</code>: a returning the reference to the iterator, which is the object itself<a href="game-of-life-numpy.html#fn98" class="footnote-ref" id="fnref98"><sup>98</sup></a>. In the <code>__next__(self)</code>, check if <code>iter</code> is within the (<code>aliens</code> or <code>lasershots</code>) list length. If it is not (i.e., you ran out aliens/shots to iterate over), <code>raise StopIteration</code>. If it is, increase the iteration counter and return the element it was indexing <em>before</em> that: Think about why you need to return <code>self.aliens[self.iter - 1]</code> rather than <code>self.aliens[self.iter]</code> or how you can use a different starting value and range check to avoid this.</p>
<p>Do this for both classes and use them in for loops directly, i.e. looping over <code>aliens</code> and <code>laser</code> instead of <code>aliens.aliens</code> and <code>laser.lasershots</code>.</p>
<p>Test it! It should work as before, of course, but with cooler duck typing inside!</p>
<div class="rmdnote program">
<p>Turn <code>LaserGun</code> and <code>AlienArmada</code> into iterators.
Use them as iterators in <em>code11.py</em>.</p>
</div>
</div>
<div id="gotem-all" class="section level2" number="16.17">
<h2>
<span class="header-section-number">16.17</span> Got’em all!<a class="anchor" aria-label="anchor" href="#gotem-all"><i class="fas fa-link"></i></a>
</h2>
<p>Now, implement <code>__len__()</code> method for <code>AlienArmada</code> class that returns the number of remaining aliens. In the main loop, use it via <code>len()</code> function to check whether you won: no aliens left, the game is over. Use <code>len()</code> with the object, not with its <code>aliens</code> list attribute!</p>
<div class="rmdnote program">
<p>Add <code>__len__()</code> special method to <code>AlienArmada</code> class.
Use it to check whether all aliens are hit
in <em>code12.py</em>.</p>
</div>
</div>
<div id="ping" class="section level2" number="16.18">
<h2>
<span class="header-section-number">16.18</span> Ping!<a class="anchor" aria-label="anchor" href="#ping"><i class="fas fa-link"></i></a>
</h2>
<p>Now let us use a <code>HitSoundMixin</code> class that defines a single <code>hit()</code> method (no constructor!) that plays the <em>teleport.wav</em> sound<a href="game-of-life-numpy.html#fn99" class="footnote-ref" id="fnref99"><sup>99</sup></a> from <a href="material/space-invaders.zip">materials</a>. It can be a single line method when you both create and play the sound in one go, no temporary variable or an attribute are required. When you use it as an ancestor for the <code>Alien</code> class, it has that <code>hit()</code> method. Call it when you set <em>hit</em> to <code>True</code>.</p>
<div class="rmdnote program">
<p>Create <code>HitSoundMixin</code> class.
Mix it into the <code>Alien</code> class.
Use it in <em>code11.py</em>.</p>
</div>
</div>
<div id="getter-setter" class="section level2" number="16.19">
<h2>
<span class="header-section-number">16.19</span> Virtual attributes via getters and setters<a class="anchor" aria-label="anchor" href="#getter-setter"><i class="fas fa-link"></i></a>
</h2>
<p>Our next detour is to learn how you can create a private attribute (within <a href="#access-restrictions">the limits of Python</a>, of course). Recall that we have a <code>__pos</code> attribute of an <code>AlienArmada</code> class that defines its location. The catch is that changing the position of the armada means changing position of all the aliens that constitute the armada. This means that we need write a method that receive a new position for the armada and updates both the <code>__pos</code> attribute and positions of individual aliens. And that is exactly what getter/setter methods are for. They are declared via special <em>decorators</em><a href="game-of-life-numpy.html#fn100" class="footnote-ref" id="fnref100"><sup>100</sup></a>: <code>@property</code> and <code>@&lt;name&gt;.setter</code>. You already know the former one that we used to compute a value on-the-fly. But it also be used to get a value of a “private” attribute, which is why it is called a “getter” method. The latter decorator, is for a “setter” method that <em>sets</em> a new value to a private attribute. The idea of using them together is to isolate an actual attribute value from the outside influence. It is particularly helpful, if you need to control whether a new value of an attribute is a valid one, needs to converted, additional processing, etc. For example, <code>color</code> attribute of the rectangle stimulus uses this approach, which is why it can take RGB triplets, hexadecimal codes, or plain color names as a value and set the color correctly.</p>
<p>Here is a sketch of how it could work for a virtual attribute for <code>color</code>. One typically creates an <em>internal</em> attribute with almost the same name, e.g., <code>_color</code> or <code>__color</code>. The value is stored and read from that internal attribute by getter and setter methods:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="space-invaders.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExampleClass:</span>
<span id="cb135-2"><a href="space-invaders.html#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="space-invaders.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb135-4"><a href="space-invaders.html#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.__color <span class="op">=</span> <span class="st">"red"</span></span>
<span id="cb135-5"><a href="space-invaders.html#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="space-invaders.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">@property</span></span>
<span id="cb135-7"><a href="space-invaders.html#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> color(<span class="va">self</span>):</span>
<span id="cb135-8"><a href="space-invaders.html#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb135-9"><a href="space-invaders.html#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">    This is a getter method for virtual color</span></span>
<span id="cb135-10"><a href="space-invaders.html#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">    attribute.</span></span>
<span id="cb135-11"><a href="space-invaders.html#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb135-12"><a href="space-invaders.html#cb135-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Here, we simply return the value. But we could </span></span>
<span id="cb135-13"><a href="space-invaders.html#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute it from some other attribute(s) instead.</span></span>
<span id="cb135-14"><a href="space-invaders.html#cb135-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.__color</span>
<span id="cb135-15"><a href="space-invaders.html#cb135-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-16"><a href="space-invaders.html#cb135-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">@color.setter</span> <span class="co"># not the most elegant syntax, IMHO</span></span>
<span id="cb135-17"><a href="space-invaders.html#cb135-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> color(<span class="va">self</span>, newvalue):</span>
<span id="cb135-18"><a href="space-invaders.html#cb135-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb135-19"><a href="space-invaders.html#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Note that the setter name has THE SAME name as the getter!</span></span>
<span id="cb135-20"><a href="space-invaders.html#cb135-20" aria-hidden="true" tabindex="-1"></a><span class="co">    It sets a new value and does not return anything.</span></span>
<span id="cb135-21"><a href="space-invaders.html#cb135-21" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb135-22"><a href="space-invaders.html#cb135-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-23"><a href="space-invaders.html#cb135-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Here, you can have checks, conversion, </span></span>
<span id="cb135-24"><a href="space-invaders.html#cb135-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># additional changes to other attributes, etc.</span></span>
<span id="cb135-25"><a href="space-invaders.html#cb135-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.__color <span class="op">=</span> newvalue</span>
<span id="cb135-26"><a href="space-invaders.html#cb135-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-27"><a href="space-invaders.html#cb135-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-28"><a href="space-invaders.html#cb135-28" aria-hidden="true" tabindex="-1"></a>example <span class="op">=</span> ExampleClass()</span>
<span id="cb135-29"><a href="space-invaders.html#cb135-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-30"><a href="space-invaders.html#cb135-30" aria-hidden="true" tabindex="-1"></a><span class="co"># get the value, note the lack of () after color</span></span>
<span id="cb135-31"><a href="space-invaders.html#cb135-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(example.color)</span>
<span id="cb135-32"><a href="space-invaders.html#cb135-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-33"><a href="space-invaders.html#cb135-33" aria-hidden="true" tabindex="-1"></a><span class="co"># set the value</span></span>
<span id="cb135-34"><a href="space-invaders.html#cb135-34" aria-hidden="true" tabindex="-1"></a>example.color <span class="op">=</span> <span class="st">"blue"</span></span></code></pre></div>
<p>Note that there is no <em>actual</em> attribute <code>color</code><a href="game-of-life-numpy.html#fn101" class="footnote-ref" id="fnref101"><sup>101</sup></a>, yet, our code works as if it exists.</p>
<p>There is another twist to the story. If you only define the getter <code>@property</code> method but no setter method, your hidden property is read-only<a href="game-of-life-numpy.html#fn102" class="footnote-ref" id="fnref102"><sup>102</sup></a>!</p>
</div>
<div id="the-alien-armada-jumps" class="section level2" number="16.20">
<h2>
<span class="header-section-number">16.20</span> The alien armada jumps<a class="anchor" aria-label="anchor" href="#the-alien-armada-jumps"><i class="fas fa-link"></i></a>
</h2>
<p>Currently, our aliens are sitting ducks. No fun! They need to get a move on. But before we can move alien armada around, we need to be able to change its position. So let us write getter/setter methods for it. To start with, define a getter, as it only needs to return the value of the hidden position attribute.</p>
<p>Now to more complicated and, hence, fun bit! Remember, we need to move <em>all</em> individual aliens relative to the center of the armada. For this,</p>
<ol style="list-style-type: decimal">
<li>compute the <em>change</em> in its position based on current and new value,</li>
<li>use it to alter position of individual aliens based on their current position,</li>
<li>store the new position in the private attribute.</li>
</ol>
<p>Test it by making armada jump to a random location every time you press <em>space</em> button. The armada should keep its formation!</p>
<div class="rmdnote program">
<p>Implement getter/setter methods for <code>__pos</code> in <code>AlienArmada</code>.
Test it in <em>code12.py</em>.</p>
</div>
</div>
<div id="the-alien-armada-moves" class="section level2" number="16.21">
<h2>
<span class="header-section-number">16.21</span> The alien armada moves<a class="anchor" aria-label="anchor" href="#the-alien-armada-moves"><i class="fas fa-link"></i></a>
</h2>
<p>Our alien armada will move downwards along a sine trajectory:</p>
<p><span class="math display">\[x = x_{max} \cdot sin(2 \pi f \cdot (y-y_{origin})) \]</span>
where <span class="math inline">\(x_{max}\)</span> is maximal deviation of the <em>center</em> of the armada from the middle of the screen (I’ve set it to <span class="math inline">\(0.25\)</span>), the <span class="math inline">\(f\)</span> is the frequency, i.e., how fast is horizontal movement (I’ve set it to <span class="math inline">\(3\)</span> but you can see how much slower it would be for <span class="math inline">\(1\)</span> in the plot below), <span class="math inline">\(y\)</span> is the current vertical coordinate of the armada and <span class="math inline">\(y_{origin}\)</span> is the initial one (<span class="math inline">\(0.5\)</span> in my case). As with all other parameters, these should be part of the settings file plus <code>vertcal speed [norm/sec]</code> that defines how fast the armada will fly down (I would set it to 0.1, so it takes 15 seconds to fly down).</p>
<div class="inline-figure"><img src="14-space-invaders-duck-typing_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>For the armada to fly, we need to add a timer (in the constructor) and define a <code>fly()</code> method that</p>
<ol style="list-style-type: decimal">
<li>computes the times since the armada creation</li>
<li>computes current vertical position based on the starting location, elapsed time (from the timer), vertical speed defined in settings</li>
<li>computes current horizontal position given the formula above and the relevant settings</li>
<li>updates current position via a simple <code>self.pos = (new_x, new_y)</code> (the setter method will take care of the rest)</li>
</ol>
<p>In the main loop, call <code>fly()</code> when you call it for laser gun.</p>
<div class="rmdnote program">
<p>Add <code>fly()</code> method to <code>AlienArmada</code> class.<br>
Use it in <em>code13.py</em>.</p>
</div>
</div>
<div id="the-alien-armada-wins-crash" class="section level2" number="16.22">
<h2>
<span class="header-section-number">16.22</span> The alien armada wins: crash!<a class="anchor" aria-label="anchor" href="#the-alien-armada-wins-crash"><i class="fas fa-link"></i></a>
</h2>
<p>So far, the player always wins. Let us make it more dangerous! They will lose if either an alien crashes into the spaceship or if the armada goes past the ship. Implement the former the same way as you checked whether laser shot hit an alien: loop over aliens and see if they overlap with the spaceship (game over if they do). Implement and test.</p>
<div class="rmdnote program">
<p>Implement crash-into-ship in <em>code14.py</em>.</p>
</div>
</div>
<div id="the-alien-armada-wins-missed-them" class="section level2" number="16.23">
<h2>
<span class="header-section-number">16.23</span> The alien armada wins: missed them!<a class="anchor" aria-label="anchor" href="#the-alien-armada-wins-missed-them"><i class="fas fa-link"></i></a>
</h2>
<p>The second way to lose the game, is if at least one alien got past the ship. For this, we need to check the position of the <em>lowest</em> alien and if it is lower than that of the spaceship, the game is over. You can do it in the same loop you are checking for the hit but, for didactic reasons, let us practice <code>@proprety</code> a bit more. Implement a new computed (read-only) property <code>lowest_y</code> of the <code>AlienArmada</code> class that will return the y-coordinate of the lowest alien in the armada. You need to loop over individual aliens to find the lowest y and return it. There are different ways to do it, come up with one yourself! In the main code, add the check and make sure the game is over, if aliens got past the player.</p>
<div class="rmdnote program">
<p>Add <code>lowest_y</code> computed property to <code>AlienArmada</code> class.<br>
Use it in <em>code15.py</em>.</p>
</div>
</div>
<div id="mixin-teleport" class="section level2" number="16.24">
<h2>
<span class="header-section-number">16.24</span> Mixin teleport<a class="anchor" aria-label="anchor" href="#mixin-teleport"><i class="fas fa-link"></i></a>
</h2>
<p>Mix in the teleport sound method to the <code>Spaceship</code> and play it if alien crashed into it.</p>
<div class="rmdnote program">
<p>Mix in teleport to <code>Spaceship</code> class.<br>
Use it in <em>code16.py</em>.</p>
</div>
</div>
<div id="game-over-message" class="section level2" number="16.25">
<h2>
<span class="header-section-number">16.25</span> Game over message<a class="anchor" aria-label="anchor" href="#game-over-message"><i class="fas fa-link"></i></a>
</h2>
<p>Create a blinking game over message that will reflect the outcome. Something like this but use your imagination:</p>
<ul>
<li>“Congrats!”, if the player won.</li>
<li>“Crash! Boom! Bang!”, if the player was hit.</li>
<li>“They got away!”, if the armada got past the player.</li>
</ul>
<p>One way to simplify you life is to rename <code>gameover</code> variable into the <code>gamestate</code> variable. Initially, it could be <code>"playing"</code>, so your loop repeats <code>while gamestate == "playing"</code>. Then, you can set it based on the type of the event (<code>"victory"</code> when player wins, <code>"hit"</code> when they were hit by the armada, <code>"missed"</code> if aliens got away) and use it after the main loop to determine which message to show. Better still, use dictionary for this instead of if-else. Or “cheat” and store the message in the variable itself.</p>
<div class="rmdnote program">
<p>Put your updated code into <em>code17.py</em>.</p>
</div>
</div>
<div id="we-want-more" class="section level2" number="16.26">
<h2>
<span class="header-section-number">16.26</span> We want more!<a class="anchor" aria-label="anchor" href="#we-want-more"><i class="fas fa-link"></i></a>
</h2>
<p>You have a solid game but it can be improved in many ways. Score? Difficulty? More levels? Aliens shooting back at you? Anything is possible!</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="moon-lander.html"><span class="header-section-number">15</span> Moon lander</a></div>
<div class="next"><a href="game-of-life-numpy.html"><span class="header-section-number">17</span> Game of life (NumPy)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#space-invaders"><span class="header-section-number">16</span> Space invaders: mixins and duck typing</a></li>
<li><a class="nav-link" href="#mixins"><span class="header-section-number">16.1</span> Mixins</a></li>
<li><a class="nav-link" href="#duck-typing"><span class="header-section-number">16.2</span> Duck typing</a></li>
<li><a class="nav-link" href="#which-one-to-use"><span class="header-section-number">16.3</span> Which one to use?</a></li>
<li><a class="nav-link" href="#space-invaders-1"><span class="header-section-number">16.4</span> Space Invaders</a></li>
<li><a class="nav-link" href="#boilerplate-2"><span class="header-section-number">16.5</span> Boilerplate</a></li>
<li><a class="nav-link" href="#the-spaceship"><span class="header-section-number">16.6</span> The spaceship</a></li>
<li><a class="nav-link" href="#the-spaceship-moves"><span class="header-section-number">16.7</span> The spaceship moves</a></li>
<li><a class="nav-link" href="#an-alien-appears"><span class="header-section-number">16.8</span> An alien appears</a></li>
<li><a class="nav-link" href="#using-names-to-indicate-access-restrictions"><span class="header-section-number">16.9</span> Using names to indicate access restrictions</a></li>
<li><a class="nav-link" href="#an-alien-armada-appears"><span class="header-section-number">16.10</span> An alien armada appears</a></li>
<li><a class="nav-link" href="#a-laser-shot-appears"><span class="header-section-number">16.11</span> A laser shot appears</a></li>
<li><a class="nav-link" href="#the-laser-shot-flies"><span class="header-section-number">16.12</span> The laser shot flies</a></li>
<li><a class="nav-link" href="#we-want-more-lasers"><span class="header-section-number">16.13</span> We want more lasers!</a></li>
<li><a class="nav-link" href="#too-many-lasers"><span class="header-section-number">16.14</span> Too many lasers!</a></li>
<li><a class="nav-link" href="#i-am-hit-i-am-hit"><span class="header-section-number">16.15</span> I am hit! I am hit!</a></li>
<li><a class="nav-link" href="#duck-typiing-iterators"><span class="header-section-number">16.16</span> Duck typiing iterators</a></li>
<li><a class="nav-link" href="#gotem-all"><span class="header-section-number">16.17</span> Got’em all!</a></li>
<li><a class="nav-link" href="#ping"><span class="header-section-number">16.18</span> Ping!</a></li>
<li><a class="nav-link" href="#getter-setter"><span class="header-section-number">16.19</span> Virtual attributes via getters and setters</a></li>
<li><a class="nav-link" href="#the-alien-armada-jumps"><span class="header-section-number">16.20</span> The alien armada jumps</a></li>
<li><a class="nav-link" href="#the-alien-armada-moves"><span class="header-section-number">16.21</span> The alien armada moves</a></li>
<li><a class="nav-link" href="#the-alien-armada-wins-crash"><span class="header-section-number">16.22</span> The alien armada wins: crash!</a></li>
<li><a class="nav-link" href="#the-alien-armada-wins-missed-them"><span class="header-section-number">16.23</span> The alien armada wins: missed them!</a></li>
<li><a class="nav-link" href="#mixin-teleport"><span class="header-section-number">16.24</span> Mixin teleport</a></li>
<li><a class="nav-link" href="#game-over-message"><span class="header-section-number">16.25</span> Game over message</a></li>
<li><a class="nav-link" href="#we-want-more"><span class="header-section-number">16.26</span> We want more!</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy/blob/master/14-space-invaders-duck-typing.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/alexander-pastukhov/writing-games-with-python-and-psychopy/edit/master/14-space-invaders-duck-typing.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Writing games with Python and PsychoPy</strong>" was written by Alexander (Sasha) Pastukhov. It was last built on 2022-06-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
